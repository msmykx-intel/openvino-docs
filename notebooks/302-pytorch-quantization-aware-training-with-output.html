
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Quantization Aware Training with NNCF, using PyTorch framework &#8212; OpenVINO™  documentation</title>
    
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <link href="../_static/css/media/favicon.ico" rel="shortcut icon">
    <link rel="stylesheet" href="../_static/css/openvino_sphinx_theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/input.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/textfield.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/tabs.css" type="text/css" />
    <script src="../_static/js/openvino_sphinx_theme.js"></script>
    <link rel="stylesheet" href="../_static/css/viewer.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-barchart-background@1.3.0/build/Plugin.Barchart.Background.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
    <script src="../_static/js/viewer.min.js"></script>
    <script src="/assets/versions_raw.js"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/custom.js"></script>
    <script src="../_static/js/graphs.js"></script>
    <script src="../_static/js/graphs_ov_tf.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/target-highlight.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="canonical" href="https://docs.openvino.ai/latest/notebooks/302-pytorch-quantization-aware-training-with-output.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Quantization Aware Training with NNCF, using TensorFlow Framework" href="305-tensorflow-quantization-aware-training-with-output.html" />
    <link rel="prev" title="From Training to Deployment with TensorFlow and OpenVINO™" href="301-tensorflow-training-openvino-with-output.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
      <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/get-started-guide.html">
  Get Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/documentation.html">
  Documentation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../tutorials.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api_reference.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../model_zoo.html">
  Model Zoo
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/resources.html">
  Resources
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/openvinotoolkit/openvino" rel="noopener" target="_blank" title="GitHub">
            <span><i class="sst-github"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
</ul>
      </div>
      
      <div class="navbar-end-item">
        
<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="version-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
  <div class="dropdown-menu" aria-labelledby="version-selector">
  </div>
</div>
      </div>
      
      <div class="navbar-end-item">
        

<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="language-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</button>
  <div class="dropdown-menu" aria-labelledby="language-selector">
    
      
        <a class="dropdown-item font-weight-bold" href="/openvino-docs/index.html">English</a>
      
    
      
        <a  class="dropdown-item" href="/cn/openvino-docs/index.html">Chinese</a>
      
    
  </div>
</div>

      </div>
      
    </div>
  </div>
</div>
        <div id="collapse-nav-wrapper" class="container-xl">
          <button id="collapse-nav" class="button bttn-prm button-size-m" type="button" data-toggle="collapse" data-target="#nav-tree" aria-expanded="false" aria-controls="nav-tree">
            Documentation navigation <i class="fas fa-chevron-down"></i>
          </button>
        </div>
      </nav>
      <div class="transition-banner container-fluid alert alert-info alert-dismissible fade show" role="alert">
        <p>OpenVINO 2022.1 introduces a new version of OpenVINO API (API 2.0). For more information on the changes and transition steps, see the <a href="https://docs.openvino.ai/latest/openvino_2_0_transition_guide.html">transition guide</a></p>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
    </div>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar" id="nav-tree"><form class="searchForm bd-search d-flex align-items-center" action="../search.html" method="get">
    <i class="icon fas fa-search"></i>
    <input type="search" class="form-control" name="query" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notebooks
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks-installation.html">
   Installation of OpenVINO™ Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="001-hello-world-with-output.html">
   Hello Image Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="002-openvino-api-with-output.html">
   OpenVINO™ Runtime API Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="003-hello-segmentation-with-output.html">
   Hello Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="004-hello-detection-with-output.html">
   Hello Object Detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="101-tensorflow-to-openvino-with-output.html">
   Convert a TensorFlow Model to OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="102-pytorch-onnx-to-openvino-with-output.html">
   Convert a PyTorch Model to ONNX and OpenVINO™ IR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="103-paddle-onnx-to-openvino-classification-with-output.html">
   Convert a PaddlePaddle Model to ONNX and OpenVINO™ IR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="104-model-tools-with-output.html">
   Working with Open Model Zoo Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="105-language-quantize-bert-with-output.html">
   Quantize NLP models with Post-Training Optimization Tool ​in OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="106-auto-device-with-output.html">
   Automatic Device Selection with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="107-speech-recognition-quantization-with-output.html">
   Quantize Speech Recognition Models with OpenVINO™ Post-Training Optimization Tool ​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="110-ct-segmentation-quantize-nncf-with-output.html">
   Quantize a Segmentation Model and Show Live Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="110-ct-segmentation-quantize-with-output.html">
   Quantize a Segmentation Model and Show Live Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="111-detection-quantization-with-output.html">
   Object Detection Quantization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="112-pytorch-post-training-quantization-nncf-with-output.html">
   Post-Training Quantization of PyTorch models with NNCF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="113-image-classification-quantization-with-output.html">
   Quantization of Image Classification Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="114-quantization-simplified-mode-with-output.html">
   INT8 Quantization with Post-training Optimization Tool (POT) in Simplified Mode tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="115-async-api-with-output.html">
   Asynchronous Inference with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="201-vision-monodepth-with-output.html">
   Monodepth Estimation with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="202-vision-superresolution-image-with-output.html">
   Single Image Super Resolution with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="202-vision-superresolution-video-with-output.html">
   Video Super Resolution with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="203-meter-reader-with-output.html">
   Industrial Meter Reader
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="204-named-entity-recognition-with-output.html">
   Document Entity Extraction with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="205-vision-background-removal-with-output.html">
   Image Background Removal with U^2-Net and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="206-vision-paddlegan-anime-with-output.html">
   Photos to Anime with PaddleGAN and OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="207-vision-paddlegan-superresolution-with-output.html">
   Super Resolution with PaddleGAN and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="208-optical-character-recognition-with-output.html">
   Optical Character Recognition (OCR) with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="209-handwritten-ocr-with-output.html">
   Handwritten Chinese and Japanese OCR with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="210-ct-scan-live-inference-with-output.html">
   Live Inference and Benchmark CT-scan Data with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="211-speech-to-text-with-output.html">
   Speech to Text with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="212-onnx-style-transfer-with-output.html">
   Style Transfer on ONNX Models with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="214-vision-paddle-classification-with-output.html">
   PaddlePaddle Image Classification with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="215-image-inpainting-with-output.html">
   Image In-painting with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="216-license-plate-recognition-with-output.html">
   License Plate Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="217-vision-deblur-with-output.html">
   Deblur Photos with DeblurGAN-v2 and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="218-vehicle-detection-and-recognition-with-output.html">
   Vehicle Detection And Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="219-knowledge-graphs-conve-with-output.html">
   OpenVINO optimizations for Knowledge graphs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="220-yolov5-accuracy-check-and-quantization-with-output.html">
   Quantize the Ultralytics YOLOv5 model and check accuracy using the OpenVINO POT API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="221-machine-translation-with-output.html">
   Machine translation demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="222-vision-image-colorization-with-output.html">
   Image Colorization with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="223-gpt2-text-prediction-with-output.html">
   GPT-2 Text Prediction with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="301-tensorflow-training-openvino-pot-with-output.html">
   Post-Training Quantization with TensorFlow Classification Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="301-tensorflow-training-openvino-with-output.html">
   From Training to Deployment with TensorFlow and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Quantization Aware Training with NNCF, using PyTorch framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="305-tensorflow-quantization-aware-training-with-output.html">
   Quantization Aware Training with NNCF, using TensorFlow Framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="401-object-detection-with-output.html">
   Live Object Detection with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="402-pose-estimation-with-output.html">
   Live Human Pose Estimation with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="403-action-recognition-webcam-with-output.html">
   Human Action Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="405-paddle-ocr-webcam-with-output.html">
   PaddleOCR with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="notebook_utils-with-output.html">
   Notebook Utils
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#imports-and-settings">
   Imports and Settings
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#pre-train-floating-point-model">
   Pre-train Floating-Point Model
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#train-function">
     Train Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#validate-function">
     Validate Function
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#helpers">
     Helpers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#get-a-pre-trained-fp32-model">
     Get a Pre-trained FP32 Model
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#create-and-initialize-quantization">
   Create and Initialize Quantization
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#fine-tune-the-compressed-model">
   Fine-tune the Compressed Model
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#export-int8-model-to-onnx">
   Export INT8 Model to ONNX
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#convert-onnx-models-to-openvino-intermediate-representation-ir">
   Convert ONNX models to OpenVINO Intermediate Representation (IR)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#benchmark-model-performance-by-computing-inference-time">
   Benchmark Model Performance by Computing Inference Time
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                <div class="tocsection download-docs">
  <div class="dropdown sst-dropdown">
    <button class="button bttn-prm button-size-m" data-display="static" type="button" id="download-options"
      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Download Docs
    </button>
    <div class="dropdown-menu" aria-labelledby="download-options">
      <a class="dropdown-item" href="#" onclick="window.print()">.pdf</a>
      <a id="download-zip-btn" class="dropdown-item" href="#">.zip</a>
    </div>
  </div>
</div>
              </div>
              
            
          </div>
          

          
          
              
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">

<div class="tocsection editthispage">
    <a href="None">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

            
                <div>
                  
  <section id="quantization-aware-training-with-nncf-using-pytorch-framework">
<h1>Quantization Aware Training with NNCF, using PyTorch framework<a class="headerlink" href="#quantization-aware-training-with-nncf-using-pytorch-framework" title="Permalink to this headline">¶</a></h1>
<p>This notebook is based on <a class="reference external" href="https://github.com/pytorch/examples/blob/master/imagenet/main.py">ImageNet training in
PyTorch</a>.</p>
<p>The goal of this notebook is to demonstrate how to use the Neural
Network Compression Framework
<a class="reference external" href="https://github.com/openvinotoolkit/nncf">NNCF</a> 8-bit quantization to
optimize a PyTorch model for inference with OpenVINO Toolkit. The
optimization process contains the following steps:</p>
<ul class="simple">
<li><p>Transforming the original <code class="docutils literal notranslate"><span class="pre">FP32</span></code> model to <code class="docutils literal notranslate"><span class="pre">INT8</span></code></p></li>
<li><p>Using fine-tuning to restore the accuracy.</p></li>
<li><p>Exporting optimized and original models to ONNX and then to OpenVINO
IR</p></li>
<li><p>Measuring and comparing the performance of models.</p></li>
</ul>
<p>For more advanced usage, refer to these
<a class="reference external" href="https://github.com/openvinotoolkit/nncf/tree/develop/examples">examples</a>.</p>
<p>This tutorial uses the ResNet-18 model with the Tiny ImageNet-200
dataset. ResNet-18 is the version of ResNet models that contains the
fewest layers (18). Tiny ImageNet-200 is a subset of the larger ImageNet
dataset with smaller images. The dataset will be downloaded in the
notebook. Using the smaller model and dataset will speed up training and
download time. To see other ResNet models, visit <a class="reference external" href="https://pytorch.org/hub/pytorch_vision_resnet/">PyTorch
hub</a>.</p>
<blockquote>
<div><p><strong>NOTE</strong>: This notebook requires a C++ compiler.</p>
</div></blockquote>
<section id="imports-and-settings">
<h2>Imports and Settings<a class="headerlink" href="#imports-and-settings" title="Permalink to this headline">¶</a></h2>
<p>On Windows, add the required C++ directories to the system PATH.</p>
<p>Import NNCF and all auxiliary packages from your Python code. Set a name
for the model, and the image width and height that will be used for the
network. Also define paths where PyTorch, ONNX and OpenVINO IR versions
of the models will be stored.</p>
<blockquote>
<div><p><strong>NOTE</strong>: All NNCF logging messages below ERROR level (INFO and
WARNING) are disabled to simplify the tutorial. For production use,
it is recommended to enable logging by removing
<code class="docutils literal notranslate"><span class="pre">set_log_level(logging.ERROR)</span></code>.</p>
</div></blockquote>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># On Windows, add the directory that contains cl.exe to the PATH to enable PyTorch to find the
# required C++ tools. This code assumes that Visual Studio 2019 is installed in the default
# directory. If you have a different C++ compiler, add the correct path to os.environ[&quot;PATH&quot;]
# directly. Note that the C++ Redistributable is not enough to run this notebook.

# Adding the path to os.environ[&quot;LIB&quot;] is not always required - it depends on the system configuration

import sys

if sys.platform == &quot;win32&quot;:
    import distutils.command.build_ext
    import os
    from pathlib import Path

    VS_INSTALL_DIR = r&quot;C:/Program Files (x86)/Microsoft Visual Studio&quot;
    cl_paths = sorted(list(Path(VS_INSTALL_DIR).glob(&quot;**/Hostx86/x64/cl.exe&quot;)))
    if len(cl_paths) == 0:
        raise ValueError(
            &quot;Cannot find Visual Studio. This notebook requires a C++ compiler. If you installed &quot;
            &quot;a C++ compiler, please add the directory that contains cl.exe to `os.environ[&#39;PATH&#39;]`.&quot;
        )
    else:
        # If multiple versions of MSVC are installed, get the most recent one.
        cl_path = cl_paths[-1]
        vs_dir = str(cl_path.parent)
        os.environ[&quot;PATH&quot;] += f&quot;{os.pathsep}{vs_dir}&quot;
        # The code for finding the library dirs is from:
        # https://stackoverflow.com/questions/47423246/get-pythons-lib-path
        d = distutils.core.Distribution()
        b = distutils.command.build_ext.build_ext(d)
        b.finalize_options()
        os.environ[&quot;LIB&quot;] = os.pathsep.join(b.library_dirs)
        print(f&quot;Added {vs_dir} to PATH&quot;)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import sys
import time
import warnings  # To disable warnings on export to ONNX.
import zipfile
from pathlib import Path
import logging

import torch
import nncf  # Important - should be imported directly after torch.

import torch.nn as nn
import torch.nn.parallel
import torch.optim
import torch.utils.data
import torch.utils.data.distributed
import torchvision.datasets as datasets
import torchvision.models as models
import torchvision.transforms as transforms

from nncf.common.utils.logger import set_log_level
set_log_level(logging.ERROR)  # Disables all NNCF info and warning messages.
from nncf import NNCFConfig
from nncf.torch import create_compressed_model, register_default_init_args
from openvino.runtime import Core
from torch.jit import TracerWarning

sys.path.append(&quot;../utils&quot;)
from notebook_utils import download_file

torch.manual_seed(0)
device = torch.device(&quot;cuda&quot; if torch.cuda.is_available() else &quot;cpu&quot;)
print(f&quot;Using {device} device&quot;)

MODEL_DIR = Path(&quot;model&quot;)
OUTPUT_DIR = Path(&quot;output&quot;)
DATA_DIR = Path(&quot;data&quot;)
BASE_MODEL_NAME = &quot;resnet18&quot;
image_size = 64

OUTPUT_DIR.mkdir(exist_ok=True)
MODEL_DIR.mkdir(exist_ok=True)
DATA_DIR.mkdir(exist_ok=True)

# Paths where PyTorch, ONNX and OpenVINO IR models will be stored.
fp32_pth_path = Path(MODEL_DIR / (BASE_MODEL_NAME + &quot;_fp32&quot;)).with_suffix(&quot;.pth&quot;)
fp32_onnx_path = Path(OUTPUT_DIR / (BASE_MODEL_NAME + &quot;_fp32&quot;)).with_suffix(&quot;.onnx&quot;)
fp32_ir_path = fp32_onnx_path.with_suffix(&quot;.xml&quot;)
int8_onnx_path = Path(OUTPUT_DIR / (BASE_MODEL_NAME + &quot;_int8&quot;)).with_suffix(&quot;.onnx&quot;)
int8_ir_path = int8_onnx_path.with_suffix(&quot;.xml&quot;)

# It is possible to train FP32 model from scratch, but it might be slow. Therefore, the pre-trained weights are downloaded by default.
pretrained_on_tiny_imagenet = True
fp32_pth_url = &quot;https://storage.openvinotoolkit.org/repositories/nncf/openvino_notebook_ckpts/302_resnet18_fp32_v1.pth&quot;
download_file(fp32_pth_url, directory=MODEL_DIR, filename=fp32_pth_path.name)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">nncf</span><span class="o">/</span><span class="n">torch</span><span class="o">/</span><span class="fm">__init__</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">23</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">NNCF</span> <span class="n">provides</span> <span class="n">best</span> <span class="n">results</span> <span class="k">with</span> <span class="n">torch</span><span class="o">==</span><span class="mf">1.9.1</span><span class="p">,</span> <span class="k">while</span> <span class="n">current</span> <span class="n">torch</span> <span class="n">version</span> <span class="ow">is</span> <span class="mf">1.8.1</span><span class="o">+</span><span class="n">cpu</span> <span class="o">-</span> <span class="n">consider</span> <span class="n">switching</span> <span class="n">to</span> <span class="n">torch</span><span class="o">==</span><span class="mf">1.9.1</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;NNCF provides best results with torch==</span><span class="si">{bkc}</span><span class="s2">, &quot;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">No</span> <span class="n">CUDA</span> <span class="n">runtime</span> <span class="ow">is</span> <span class="n">found</span><span class="p">,</span> <span class="n">using</span> <span class="n">CUDA_HOME</span><span class="o">=</span><span class="s1">&#39;/usr/local/cuda&#39;</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">nncf</span><span class="o">/</span><span class="n">torch</span><span class="o">/</span><span class="n">dynamic_graph</span><span class="o">/</span><span class="n">patch_pytorch</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">163</span><span class="p">:</span> <span class="ne">UserWarning</span><span class="p">:</span> <span class="n">Not</span> <span class="n">patching</span> <span class="n">unique_dim</span> <span class="n">since</span> <span class="n">it</span> <span class="ow">is</span> <span class="n">missing</span> <span class="ow">in</span> <span class="n">this</span> <span class="n">version</span> <span class="n">of</span> <span class="n">PyTorch</span>
  <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Not patching </span><span class="si">{}</span><span class="s2"> since it is missing in this version of PyTorch&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">op_name</span><span class="p">))</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Using</span> <span class="n">cpu</span> <span class="n">device</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>model/resnet18_fp32.pth:   0%|          | 0.00/43.1M [00:00&lt;?, ?B/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">PosixPath</span><span class="p">(</span><span class="s1">&#39;/opt/home/k8sworker/cibuilds/ov-notebook/OVNotebookOps-231/.workspace/scm/ov-notebook/notebooks/302-pytorch-quantization-aware-training/model/resnet18_fp32.pth&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Download Tiny ImageNet dataset * 100k images of shape 3x64x64 * 200
different classes: snake, spider, cat, truck, grasshopper, gull, etc.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def download_tiny_imagenet_200(
    data_dir: Path,
    url=&quot;http://cs231n.stanford.edu/tiny-imagenet-200.zip&quot;,
    tarname=&quot;tiny-imagenet-200.zip&quot;,
):
    archive_path = data_dir / tarname
    download_file(url, directory=data_dir, filename=tarname)
    zip_ref = zipfile.ZipFile(archive_path, &quot;r&quot;)
    zip_ref.extractall(path=data_dir)
    zip_ref.close()

def prepare_tiny_imagenet_200(dataset_dir: Path):
    # Format validation set the same way as train set is formatted.
    val_data_dir = dataset_dir / &#39;val&#39;
    val_annotations_file = val_data_dir / &#39;val_annotations.txt&#39;
    with open(val_annotations_file, &#39;r&#39;) as f:
        val_annotation_data = map(lambda line: line.split(&#39;\t&#39;)[:2], f.readlines())
    val_images_dir = val_data_dir / &#39;images&#39;
    for image_filename, image_label in val_annotation_data:
        from_image_filepath = val_images_dir / image_filename
        to_image_dir = val_data_dir / image_label
        if not to_image_dir.exists():
            to_image_dir.mkdir()
        to_image_filepath = to_image_dir / image_filename
        from_image_filepath.rename(to_image_filepath)
    val_annotations_file.unlink()
    val_images_dir.rmdir()


DATASET_DIR = DATA_DIR / &quot;tiny-imagenet-200&quot;
if not DATASET_DIR.exists():
    download_tiny_imagenet_200(DATA_DIR)
    prepare_tiny_imagenet_200(DATASET_DIR)
    print(f&quot;Successfully downloaded and prepared dataset at: {DATASET_DIR}&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>data/tiny-imagenet-200.zip:   0%|          | 0.00/237M [00:00&lt;?, ?B/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Successfully</span> <span class="n">downloaded</span> <span class="ow">and</span> <span class="n">prepared</span> <span class="n">dataset</span> <span class="n">at</span><span class="p">:</span> <span class="n">data</span><span class="o">/</span><span class="n">tiny</span><span class="o">-</span><span class="n">imagenet</span><span class="o">-</span><span class="mi">200</span>
</pre></div>
</div>
</section>
<section id="pre-train-floating-point-model">
<h2>Pre-train Floating-Point Model<a class="headerlink" href="#pre-train-floating-point-model" title="Permalink to this headline">¶</a></h2>
<p>Using NNCF for model compression assumes that a pre-trained model and a
training pipeline are already in use.</p>
<p>This tutorial demonstrates one possible training pipeline: a ResNet-18
model pre-trained on 1000 classes from ImageNet is fine-tuned with 200
classes from Tiny-Imagenet.</p>
<p>Subsequently, the training and validation functions will be reused as is
for quantization-aware training.</p>
<section id="train-function">
<h3>Train Function<a class="headerlink" href="#train-function" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def train(train_loader, model, criterion, optimizer, epoch):
    batch_time = AverageMeter(&quot;Time&quot;, &quot;:3.3f&quot;)
    losses = AverageMeter(&quot;Loss&quot;, &quot;:2.3f&quot;)
    top1 = AverageMeter(&quot;Acc@1&quot;, &quot;:2.2f&quot;)
    top5 = AverageMeter(&quot;Acc@5&quot;, &quot;:2.2f&quot;)
    progress = ProgressMeter(
        len(train_loader), [batch_time, losses, top1, top5], prefix=&quot;Epoch:[{}]&quot;.format(epoch)
    )

    # Switch to train mode.
    model.train()

    end = time.time()
    for i, (images, target) in enumerate(train_loader):
        images = images.to(device)
        target = target.to(device)

        # Compute output.
        output = model(images)
        loss = criterion(output, target)

        # Measure accuracy and record loss.
        acc1, acc5 = accuracy(output, target, topk=(1, 5))
        losses.update(loss.item(), images.size(0))
        top1.update(acc1[0], images.size(0))
        top5.update(acc5[0], images.size(0))

        # Compute gradient and do opt step.
        optimizer.zero_grad()
        loss.backward()
        optimizer.step()

        # Measure elapsed time.
        batch_time.update(time.time() - end)
        end = time.time()

        print_frequency = 50
        if i % print_frequency == 0:
            progress.display(i)
</pre></div>
</div>
</section>
<section id="validate-function">
<h3>Validate Function<a class="headerlink" href="#validate-function" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def validate(val_loader, model, criterion):
    batch_time = AverageMeter(&quot;Time&quot;, &quot;:3.3f&quot;)
    losses = AverageMeter(&quot;Loss&quot;, &quot;:2.3f&quot;)
    top1 = AverageMeter(&quot;Acc@1&quot;, &quot;:2.2f&quot;)
    top5 = AverageMeter(&quot;Acc@5&quot;, &quot;:2.2f&quot;)
    progress = ProgressMeter(len(val_loader), [batch_time, losses, top1, top5], prefix=&quot;Test: &quot;)

    # Switch to evaluate mode.
    model.eval()

    with torch.no_grad():
        end = time.time()
        for i, (images, target) in enumerate(val_loader):
            images = images.to(device)
            target = target.to(device)

            # Compute output.
            output = model(images)
            loss = criterion(output, target)

            # Measure accuracy and record loss.
            acc1, acc5 = accuracy(output, target, topk=(1, 5))
            losses.update(loss.item(), images.size(0))
            top1.update(acc1[0], images.size(0))
            top5.update(acc5[0], images.size(0))

            # Measure elapsed time.
            batch_time.update(time.time() - end)
            end = time.time()

            print_frequency = 10
            if i % print_frequency == 0:
                progress.display(i)

        print(&quot; * Acc@1 {top1.avg:.3f} Acc@5 {top5.avg:.3f}&quot;.format(top1=top1, top5=top5))
    return top1.avg
</pre></div>
</div>
</section>
<section id="helpers">
<h3>Helpers<a class="headerlink" href="#helpers" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class AverageMeter(object):
    &quot;&quot;&quot;Computes and stores the average and current value&quot;&quot;&quot;

    def __init__(self, name, fmt=&quot;:f&quot;):
        self.name = name
        self.fmt = fmt
        self.reset()

    def reset(self):
        self.val = 0
        self.avg = 0
        self.sum = 0
        self.count = 0

    def update(self, val, n=1):
        self.val = val
        self.sum += val * n
        self.count += n
        self.avg = self.sum / self.count

    def __str__(self):
        fmtstr = &quot;{name} {val&quot; + self.fmt + &quot;} ({avg&quot; + self.fmt + &quot;})&quot;
        return fmtstr.format(**self.__dict__)


class ProgressMeter(object):
    def __init__(self, num_batches, meters, prefix=&quot;&quot;):
        self.batch_fmtstr = self._get_batch_fmtstr(num_batches)
        self.meters = meters
        self.prefix = prefix

    def display(self, batch):
        entries = [self.prefix + self.batch_fmtstr.format(batch)]
        entries += [str(meter) for meter in self.meters]
        print(&quot;\t&quot;.join(entries))

    def _get_batch_fmtstr(self, num_batches):
        num_digits = len(str(num_batches // 1))
        fmt = &quot;{:&quot; + str(num_digits) + &quot;d}&quot;
        return &quot;[&quot; + fmt + &quot;/&quot; + fmt.format(num_batches) + &quot;]&quot;


def accuracy(output, target, topk=(1,)):
    &quot;&quot;&quot;Computes the accuracy over the k top predictions for the specified values of k&quot;&quot;&quot;
    with torch.no_grad():
        maxk = max(topk)
        batch_size = target.size(0)

        _, pred = output.topk(maxk, 1, True, True)
        pred = pred.t()
        correct = pred.eq(target.view(1, -1).expand_as(pred))

        res = []
        for k in topk:
            correct_k = correct[:k].reshape(-1).float().sum(0, keepdim=True)
            res.append(correct_k.mul_(100.0 / batch_size))
        return res
</pre></div>
</div>
</section>
<section id="get-a-pre-trained-fp32-model">
<h3>Get a Pre-trained FP32 Model<a class="headerlink" href="#get-a-pre-trained-fp32-model" title="Permalink to this headline">¶</a></h3>
<p>А pre-trained floating-point model is a prerequisite for quantization.
It can be obtained by tuning from scratch with the code below. However,
this usually takes a lot of time. Therefore, this code has already been
run and received good enough weights after 4 epochs (for the sake of
simplicity, tuning was not done until the best accuracy). By default,
this notebook just loads these weights without launching training. To
train the model yourself on a model pre-trained on ImageNet, set
<code class="docutils literal notranslate"><span class="pre">pretrained_on_tiny_imagenet</span> <span class="pre">=</span> <span class="pre">False</span></code> in the Imports and Settings
section at the top of this notebook.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>num_classes = 200  # 200 is for Tiny ImageNet, default is 1000 for ImageNet
init_lr = 1e-4
batch_size = 128
epochs = 4

model = models.resnet18(pretrained=not pretrained_on_tiny_imagenet)
# Update the last FC layer for Tiny ImageNet number of classes.
model.fc = nn.Linear(in_features=512, out_features=num_classes, bias=True)
model.to(device)

# Data loading code.
train_dir = DATASET_DIR / &quot;train&quot;
val_dir = DATASET_DIR / &quot;val&quot;
normalize = transforms.Normalize(mean=[0.485, 0.456, 0.406], std=[0.229, 0.224, 0.225])

train_dataset = datasets.ImageFolder(
    train_dir,
    transforms.Compose(
        [
            transforms.Resize(image_size),
            transforms.RandomHorizontalFlip(),
            transforms.ToTensor(),
            normalize,
        ]
    ),
)
val_dataset = datasets.ImageFolder(
    val_dir,
    transforms.Compose(
        [
            transforms.Resize(image_size),
            transforms.ToTensor(),
            normalize,
        ]
    ),
)

train_loader = torch.utils.data.DataLoader(
    train_dataset, batch_size=batch_size, shuffle=True, num_workers=4, pin_memory=True, sampler=None
)

val_loader = torch.utils.data.DataLoader(
    val_dataset, batch_size=batch_size, shuffle=False, num_workers=4, pin_memory=True
)

# Define loss function (criterion) and optimizer.
criterion = nn.CrossEntropyLoss().to(device)
optimizer = torch.optim.Adam(model.parameters(), lr=init_lr)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>if pretrained_on_tiny_imagenet:
    #
    # ** WARNING: The `torch.load` functionality uses Python&#39;s pickling module that
    # may be used to perform arbitrary code execution during unpickling. Only load data that you
    # trust.
    #
    checkpoint = torch.load(str(fp32_pth_path), map_location=&quot;cpu&quot;)
    model.load_state_dict(checkpoint[&quot;state_dict&quot;], strict=True)
    acc1_fp32 = checkpoint[&quot;acc1&quot;]
else:
    best_acc1 = 0
    # Training loop.
    for epoch in range(0, epochs):
        # Run a single training epoch.
        train(train_loader, model, criterion, optimizer, epoch)

        # Evaluate on validation set.
        acc1 = validate(val_loader, model, criterion)

        is_best = acc1 &gt; best_acc1
        best_acc1 = max(acc1, best_acc1)

        if is_best:
            checkpoint = {&quot;state_dict&quot;: model.state_dict(), &quot;acc1&quot;: acc1}
            torch.save(checkpoint, fp32_pth_path)
    acc1_fp32 = best_acc1

print(f&quot;Accuracy of FP32 model: {acc1_fp32:.3f}&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Accuracy</span> <span class="n">of</span> <span class="n">FP32</span> <span class="n">model</span><span class="p">:</span> <span class="mf">55.520</span>
</pre></div>
</div>
<p>Export the <code class="docutils literal notranslate"><span class="pre">FP32</span></code> model to ONNX, which is supported by OpenVINO™
Toolkit, to benchmark it in comparison with the <code class="docutils literal notranslate"><span class="pre">INT8</span></code> model.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>dummy_input = torch.randn(1, 3, image_size, image_size).to(device)

torch.onnx.export(model, dummy_input, fp32_onnx_path)
print(f&quot;FP32 ONNX model was exported to {fp32_onnx_path}.&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">FP32</span> <span class="n">ONNX</span> <span class="n">model</span> <span class="n">was</span> <span class="n">exported</span> <span class="n">to</span> <span class="n">output</span><span class="o">/</span><span class="n">resnet18_fp32</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span>
</pre></div>
</div>
</section>
</section>
<section id="create-and-initialize-quantization">
<h2>Create and Initialize Quantization<a class="headerlink" href="#create-and-initialize-quantization" title="Permalink to this headline">¶</a></h2>
<p>NNCF enables compression-aware training by integrating into regular
training pipelines. The framework is designed so that modifications to
your original training code are minor. Quantization is the simplest
scenario and requires only 3 modifications.</p>
<ol class="arabic simple">
<li><p>Configure NNCF parameters to specify compression</p></li>
</ol>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>nncf_config_dict = {
    &quot;input_info&quot;: {&quot;sample_size&quot;: [1, 3, image_size, image_size]},
    &quot;log_dir&quot;: str(OUTPUT_DIR),  # The log directory for NNCF-specific logging outputs.
    &quot;compression&quot;: {
        &quot;algorithm&quot;: &quot;quantization&quot;,  # Specify the algorithm here.
    },
}
nncf_config = NNCFConfig.from_dict(nncf_config_dict)
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Provide a data loader to initialize the values of quantization ranges
and determine which activation should be signed or unsigned from the
collected statistics, using a given number of samples.</p></li>
</ol>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>nncf_config = register_default_init_args(nncf_config, train_loader)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Create a wrapped model ready for compression fine-tuning from a
pre-trained <code class="docutils literal notranslate"><span class="pre">FP32</span></code> model and a configuration object.</p></li>
</ol>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>compression_ctrl, model = create_compressed_model(model, nncf_config)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
</pre></div>
</div>
<p>Evaluate the new model on the validation set after initialization of
quantization. The accuracy should be close to the accuracy of the
floating-point <code class="docutils literal notranslate"><span class="pre">FP32</span></code> model for a simple case like the one being
demonstrated here.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>acc1 = validate(val_loader, model, criterion)
print(f&quot;Accuracy of initialized INT8 model: {acc1:.3f}&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Test</span><span class="p">:</span> <span class="p">[</span> <span class="mi">0</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.268</span> <span class="p">(</span><span class="mf">0.268</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.003</span> <span class="p">(</span><span class="mf">1.003</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">78.12</span> <span class="p">(</span><span class="mf">78.12</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">89.84</span> <span class="p">(</span><span class="mf">89.84</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.123</span> <span class="p">(</span><span class="mf">0.138</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.900</span> <span class="p">(</span><span class="mf">1.589</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">46.09</span> <span class="p">(</span><span class="mf">61.08</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">82.03</span> <span class="p">(</span><span class="mf">84.52</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.122</span> <span class="p">(</span><span class="mf">0.131</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.712</span> <span class="p">(</span><span class="mf">1.672</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">63.28</span> <span class="p">(</span><span class="mf">59.00</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">79.69</span> <span class="p">(</span><span class="mf">83.18</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.131</span> <span class="p">(</span><span class="mf">0.131</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">2.285</span> <span class="p">(</span><span class="mf">1.773</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">52.34</span> <span class="p">(</span><span class="mf">57.43</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">68.75</span> <span class="p">(</span><span class="mf">81.50</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">40</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.162</span> <span class="p">(</span><span class="mf">0.132</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.543</span> <span class="p">(</span><span class="mf">1.820</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">64.06</span> <span class="p">(</span><span class="mf">55.98</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">85.94</span> <span class="p">(</span><span class="mf">80.79</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.122</span> <span class="p">(</span><span class="mf">0.130</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">2.002</span> <span class="p">(</span><span class="mf">1.820</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">54.69</span> <span class="p">(</span><span class="mf">55.91</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">75.78</span> <span class="p">(</span><span class="mf">80.58</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">60</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.126</span> <span class="p">(</span><span class="mf">0.130</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.703</span> <span class="p">(</span><span class="mf">1.847</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">57.81</span> <span class="p">(</span><span class="mf">55.37</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">84.38</span> <span class="p">(</span><span class="mf">80.14</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">70</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.120</span> <span class="p">(</span><span class="mf">0.130</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">2.400</span> <span class="p">(</span><span class="mf">1.874</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">46.09</span> <span class="p">(</span><span class="mf">55.00</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">72.66</span> <span class="p">(</span><span class="mf">79.50</span><span class="p">)</span>
 <span class="o">*</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">55.410</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">80.140</span>
<span class="n">Accuracy</span> <span class="n">of</span> <span class="n">initialized</span> <span class="n">INT8</span> <span class="n">model</span><span class="p">:</span> <span class="mf">55.410</span>
</pre></div>
</div>
</section>
<section id="fine-tune-the-compressed-model">
<h2>Fine-tune the Compressed Model<a class="headerlink" href="#fine-tune-the-compressed-model" title="Permalink to this headline">¶</a></h2>
<p>At this step, a regular fine-tuning process is applied to further
improve quantized model accuracy. Normally, several epochs of tuning are
required with a small learning rate, the same that is usually used at
the end of the training of the original model. No other changes in the
training pipeline are required. Here is a simple example.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>compression_lr = init_lr / 10
optimizer = torch.optim.Adam(model.parameters(), lr=compression_lr)

# Train for one epoch with NNCF.
train(train_loader, model, criterion, optimizer, epoch=0)

# Evaluate on validation set after Quantization-Aware Training (QAT case).
acc1_int8 = validate(val_loader, model, criterion)

print(f&quot;Accuracy of tuned INT8 model: {acc1_int8:.3f}&quot;)
print(f&quot;Accuracy drop of tuned INT8 model over pre-trained FP32 model: {acc1_fp32 - acc1_int8:.3f}&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
<span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">torchvision</span><span class="o">/</span><span class="n">transforms</span><span class="o">/</span><span class="n">functional_pil</span><span class="o">.</span><span class="n">py</span><span class="p">:</span><span class="mi">41</span><span class="p">:</span> <span class="ne">DeprecationWarning</span><span class="p">:</span> <span class="n">FLIP_LEFT_RIGHT</span> <span class="ow">is</span> <span class="n">deprecated</span> <span class="ow">and</span> <span class="n">will</span> <span class="n">be</span> <span class="n">removed</span> <span class="ow">in</span> <span class="n">Pillow</span> <span class="mi">10</span> <span class="p">(</span><span class="mi">2023</span><span class="o">-</span><span class="mi">07</span><span class="o">-</span><span class="mi">01</span><span class="p">)</span><span class="o">.</span> <span class="n">Use</span> <span class="n">Transpose</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span> <span class="n">instead</span><span class="o">.</span>
  <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">Image</span><span class="o">.</span><span class="n">FLIP_LEFT_RIGHT</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span>  <span class="mi">0</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.554</span> <span class="p">(</span><span class="mf">0.554</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.853</span> <span class="p">(</span><span class="mf">0.853</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">79.69</span> <span class="p">(</span><span class="mf">79.69</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">92.19</span> <span class="p">(</span><span class="mf">92.19</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span> <span class="mi">50</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.416</span> <span class="p">(</span><span class="mf">0.367</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.751</span> <span class="p">(</span><span class="mf">0.821</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">84.38</span> <span class="p">(</span><span class="mf">79.75</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">96.09</span> <span class="p">(</span><span class="mf">94.13</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">100</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.353</span> <span class="p">(</span><span class="mf">0.365</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.834</span> <span class="p">(</span><span class="mf">0.810</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">78.91</span> <span class="p">(</span><span class="mf">80.06</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">96.09</span> <span class="p">(</span><span class="mf">94.24</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">150</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.334</span> <span class="p">(</span><span class="mf">0.368</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.729</span> <span class="p">(</span><span class="mf">0.799</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">83.59</span> <span class="p">(</span><span class="mf">80.48</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">96.09</span> <span class="p">(</span><span class="mf">94.34</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">200</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.377</span> <span class="p">(</span><span class="mf">0.367</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.841</span> <span class="p">(</span><span class="mf">0.791</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">75.78</span> <span class="p">(</span><span class="mf">80.67</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">95.31</span> <span class="p">(</span><span class="mf">94.34</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">250</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.339</span> <span class="p">(</span><span class="mf">0.365</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.674</span> <span class="p">(</span><span class="mf">0.785</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">86.72</span> <span class="p">(</span><span class="mf">80.86</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">95.31</span> <span class="p">(</span><span class="mf">94.40</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">300</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.403</span> <span class="p">(</span><span class="mf">0.365</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.806</span> <span class="p">(</span><span class="mf">0.777</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">82.03</span> <span class="p">(</span><span class="mf">81.05</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">94.53</span> <span class="p">(</span><span class="mf">94.51</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">350</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.380</span> <span class="p">(</span><span class="mf">0.364</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.705</span> <span class="p">(</span><span class="mf">0.772</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">83.59</span> <span class="p">(</span><span class="mf">81.17</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">96.88</span> <span class="p">(</span><span class="mf">94.55</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">400</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.331</span> <span class="p">(</span><span class="mf">0.364</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.743</span> <span class="p">(</span><span class="mf">0.766</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">76.56</span> <span class="p">(</span><span class="mf">81.31</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">95.31</span> <span class="p">(</span><span class="mf">94.59</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">450</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.407</span> <span class="p">(</span><span class="mf">0.363</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.767</span> <span class="p">(</span><span class="mf">0.762</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">82.03</span> <span class="p">(</span><span class="mf">81.40</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">92.97</span> <span class="p">(</span><span class="mf">94.66</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">500</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.428</span> <span class="p">(</span><span class="mf">0.363</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.906</span> <span class="p">(</span><span class="mf">0.758</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">77.34</span> <span class="p">(</span><span class="mf">81.49</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">92.19</span> <span class="p">(</span><span class="mf">94.69</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">550</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.345</span> <span class="p">(</span><span class="mf">0.363</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.787</span> <span class="p">(</span><span class="mf">0.756</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">82.81</span> <span class="p">(</span><span class="mf">81.53</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">93.75</span> <span class="p">(</span><span class="mf">94.67</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">600</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.365</span> <span class="p">(</span><span class="mf">0.363</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.063</span> <span class="p">(</span><span class="mf">0.754</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">75.00</span> <span class="p">(</span><span class="mf">81.62</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">91.41</span> <span class="p">(</span><span class="mf">94.69</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">650</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.364</span> <span class="p">(</span><span class="mf">0.363</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.735</span> <span class="p">(</span><span class="mf">0.750</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">82.03</span> <span class="p">(</span><span class="mf">81.73</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">92.19</span> <span class="p">(</span><span class="mf">94.71</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">700</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.358</span> <span class="p">(</span><span class="mf">0.363</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.743</span> <span class="p">(</span><span class="mf">0.747</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">78.91</span> <span class="p">(</span><span class="mf">81.82</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">94.53</span> <span class="p">(</span><span class="mf">94.71</span><span class="p">)</span>
<span class="n">Epoch</span><span class="p">:[</span><span class="mi">0</span><span class="p">][</span><span class="mi">750</span><span class="o">/</span><span class="mi">782</span><span class="p">]</span>  <span class="n">Time</span> <span class="mf">0.328</span> <span class="p">(</span><span class="mf">0.363</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">0.628</span> <span class="p">(</span><span class="mf">0.745</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">87.50</span> <span class="p">(</span><span class="mf">81.86</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">96.09</span> <span class="p">(</span><span class="mf">94.75</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span> <span class="mi">0</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.324</span> <span class="p">(</span><span class="mf">0.324</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.081</span> <span class="p">(</span><span class="mf">1.081</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">75.78</span> <span class="p">(</span><span class="mf">75.78</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">86.72</span> <span class="p">(</span><span class="mf">86.72</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">10</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.111</span> <span class="p">(</span><span class="mf">0.133</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.916</span> <span class="p">(</span><span class="mf">1.498</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">46.88</span> <span class="p">(</span><span class="mf">62.93</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">78.91</span> <span class="p">(</span><span class="mf">84.87</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">20</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.112</span> <span class="p">(</span><span class="mf">0.125</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.565</span> <span class="p">(</span><span class="mf">1.572</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">65.62</span> <span class="p">(</span><span class="mf">61.16</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">82.03</span> <span class="p">(</span><span class="mf">84.41</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">30</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.112</span> <span class="p">(</span><span class="mf">0.120</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">2.042</span> <span class="p">(</span><span class="mf">1.684</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">57.81</span> <span class="p">(</span><span class="mf">59.55</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">71.88</span> <span class="p">(</span><span class="mf">82.56</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">40</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.111</span> <span class="p">(</span><span class="mf">0.118</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.510</span> <span class="p">(</span><span class="mf">1.738</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">64.84</span> <span class="p">(</span><span class="mf">58.10</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">85.94</span> <span class="p">(</span><span class="mf">81.76</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.109</span> <span class="p">(</span><span class="mf">0.117</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.991</span> <span class="p">(</span><span class="mf">1.746</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">51.56</span> <span class="p">(</span><span class="mf">57.95</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">75.78</span> <span class="p">(</span><span class="mf">81.40</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">60</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.109</span> <span class="p">(</span><span class="mf">0.116</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">1.575</span> <span class="p">(</span><span class="mf">1.779</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">67.19</span> <span class="p">(</span><span class="mf">57.44</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">83.59</span> <span class="p">(</span><span class="mf">80.78</span><span class="p">)</span>
<span class="n">Test</span><span class="p">:</span> <span class="p">[</span><span class="mi">70</span><span class="o">/</span><span class="mi">79</span><span class="p">]</span>   <span class="n">Time</span> <span class="mf">0.103</span> <span class="p">(</span><span class="mf">0.115</span><span class="p">)</span>  <span class="n">Loss</span> <span class="mf">2.382</span> <span class="p">(</span><span class="mf">1.804</span><span class="p">)</span>  <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">45.31</span> <span class="p">(</span><span class="mf">56.99</span><span class="p">)</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">75.78</span> <span class="p">(</span><span class="mf">80.26</span><span class="p">)</span>
 <span class="o">*</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">1</span> <span class="mf">57.420</span> <span class="n">Acc</span><span class="o">@</span><span class="mi">5</span> <span class="mf">80.880</span>
<span class="n">Accuracy</span> <span class="n">of</span> <span class="n">tuned</span> <span class="n">INT8</span> <span class="n">model</span><span class="p">:</span> <span class="mf">57.420</span>
<span class="n">Accuracy</span> <span class="n">drop</span> <span class="n">of</span> <span class="n">tuned</span> <span class="n">INT8</span> <span class="n">model</span> <span class="n">over</span> <span class="n">pre</span><span class="o">-</span><span class="n">trained</span> <span class="n">FP32</span> <span class="n">model</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.900</span>
</pre></div>
</div>
</section>
<section id="export-int8-model-to-onnx">
<h2>Export INT8 Model to ONNX<a class="headerlink" href="#export-int8-model-to-onnx" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>if not int8_onnx_path.exists():
    warnings.filterwarnings(&quot;ignore&quot;, category=TracerWarning)
    warnings.filterwarnings(&quot;ignore&quot;, category=UserWarning)
    # Export INT8 model to ONNX that is supported by OpenVINO™ Toolkit
    compression_ctrl.export_model(int8_onnx_path)
    print(f&quot;INT8 ONNX model exported to {int8_onnx_path}.&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">INT8</span> <span class="n">ONNX</span> <span class="n">model</span> <span class="n">exported</span> <span class="n">to</span> <span class="n">output</span><span class="o">/</span><span class="n">resnet18_int8</span><span class="o">.</span><span class="n">onnx</span><span class="o">.</span>
</pre></div>
</div>
</section>
<section id="convert-onnx-models-to-openvino-intermediate-representation-ir">
<h2>Convert ONNX models to OpenVINO Intermediate Representation (IR)<a class="headerlink" href="#convert-onnx-models-to-openvino-intermediate-representation-ir" title="Permalink to this headline">¶</a></h2>
<p>Use Model Optimizer to convert the ONNX model to OpenVINO IR, with
<code class="docutils literal notranslate"><span class="pre">FP16</span></code> precision. The models are saved to the current directory. Then,
add the mean values to the model and scale the output with the standard
deviation by the <code class="docutils literal notranslate"><span class="pre">--mean_values</span></code> and <code class="docutils literal notranslate"><span class="pre">--scale_values</span></code> arguments. It
is not necessary to normalize input data before propagating it through
the network with these options.</p>
<p>For more information about Model Optimizer, see the <a class="reference external" href="https://docs.openvino.ai/latest/openvino_docs_MO_DG_Deep_Learning_Model_Optimizer_DevGuide.html">Model Optimizer
Developer
Guide</a>.</p>
<p>Executing this command may take a while. There may be some errors or
warnings in the output. When Model Optimizer successfully converts the
model to OpenVINO IR, the last lines of the output will include:
<code class="docutils literal notranslate"><span class="pre">[</span> <span class="pre">SUCCESS</span> <span class="pre">]</span> <span class="pre">Generated</span> <span class="pre">IR</span> <span class="pre">version</span> <span class="pre">10</span> <span class="pre">model</span></code></p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>if not fp32_ir_path.exists():
    !mo --input_model $fp32_onnx_path --input_shape &quot;[1,3, $image_size, $image_size]&quot; --mean_values &quot;[123.675, 116.28 , 103.53]&quot; --scale_values &quot;[58.395, 57.12 , 57.375]&quot; --data_type FP16 --output_dir $OUTPUT_DIR
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">Common</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Input</span> <span class="n">Model</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">resnet18_fp32</span><span class="o">.</span><span class="n">onnx</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="k">for</span> <span class="n">generated</span> <span class="n">IR</span><span class="p">:</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span>
    <span class="o">-</span> <span class="n">IR</span> <span class="n">output</span> <span class="n">name</span><span class="p">:</span>   <span class="n">resnet18_fp32</span>
    <span class="o">-</span> <span class="n">Log</span> <span class="n">level</span><span class="p">:</span>    <span class="n">ERROR</span>
    <span class="o">-</span> <span class="n">Batch</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">layers</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Output</span> <span class="n">layers</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">shapes</span><span class="p">:</span>     <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">Source</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Target</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Layout</span><span class="p">:</span>   <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Mean</span> <span class="n">values</span><span class="p">:</span>  <span class="p">[</span><span class="mf">123.675</span><span class="p">,</span> <span class="mf">116.28</span> <span class="p">,</span> <span class="mf">103.53</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">values</span><span class="p">:</span>     <span class="p">[</span><span class="mf">58.395</span><span class="p">,</span> <span class="mf">57.12</span> <span class="p">,</span> <span class="mf">57.375</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">factor</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Precision</span> <span class="n">of</span> <span class="n">IR</span><span class="p">:</span>  <span class="n">FP16</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">fusing</span><span class="p">:</span>    <span class="kc">True</span>
    <span class="o">-</span> <span class="n">User</span> <span class="n">transformations</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Reverse</span> <span class="nb">input</span> <span class="n">channels</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">IR</span> <span class="n">generation</span> <span class="k">for</span> <span class="n">fixed</span> <span class="nb">input</span> <span class="n">shape</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">transformations</span> <span class="n">config</span> <span class="n">file</span><span class="p">:</span>  <span class="kc">None</span>
<span class="n">Advanced</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">legacy</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">new</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>  <span class="kc">False</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">found</span> <span class="ow">in</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">openvino</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">version</span><span class="p">:</span>   <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">version</span><span class="p">:</span>    <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Generated</span> <span class="n">IR</span> <span class="n">version</span> <span class="mi">11</span> <span class="n">model</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">XML</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">resnet18_fp32</span><span class="o">.</span><span class="n">xml</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">BIN</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">resnet18_fp32</span><span class="o">.</span><span class="n">bin</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Total</span> <span class="n">execution</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.51</span> <span class="n">seconds</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Memory</span> <span class="n">consumed</span><span class="p">:</span> <span class="mi">162</span> <span class="n">MB</span><span class="o">.</span>
<span class="n">It</span><span class="s1">&#39;s been a while, check for a new version of Intel(R) Distribution of OpenVINO(TM) toolkit here https://software.intel.com/content/www/us/en/develop/tools/openvino-toolkit/download.html?cid=other&amp;source=prod&amp;campid=ww_2022_bu_IOTG_OpenVINO-2022-1&amp;content=upg_all&amp;medium=organic or on the GitHub*</span>
<span class="p">[</span> <span class="n">INFO</span> <span class="p">]</span> <span class="n">The</span> <span class="n">model</span> <span class="n">was</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">IR</span> <span class="n">v11</span><span class="p">,</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">model</span> <span class="nb">format</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">source</span> <span class="n">DL</span> <span class="n">framework</span> <span class="nb">input</span><span class="o">/</span><span class="n">output</span> <span class="nb">format</span><span class="o">.</span> <span class="n">While</span> <span class="n">IR</span> <span class="n">v11</span> <span class="ow">is</span> <span class="n">backwards</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">OpenVINO</span> <span class="n">Inference</span> <span class="n">Engine</span> <span class="n">API</span> <span class="n">v1</span><span class="mf">.0</span><span class="p">,</span> <span class="n">please</span> <span class="n">use</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="p">(</span><span class="k">as</span> <span class="n">of</span> <span class="mf">2022.1</span><span class="p">)</span> <span class="n">to</span> <span class="n">take</span> <span class="n">advantage</span> <span class="n">of</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">improvements</span> <span class="ow">in</span> <span class="n">IR</span> <span class="n">v11</span><span class="o">.</span>
<span class="n">Find</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="ow">and</span> <span class="n">IR</span> <span class="n">v11</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">openvino</span><span class="o">.</span><span class="n">ai</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>if not int8_ir_path.exists():
    !mo --input_model $int8_onnx_path --input_shape &quot;[1,3, $image_size, $image_size]&quot; --mean_values &quot;[123.675, 116.28 , 103.53]&quot; --scale_values &quot;[58.395, 57.12 , 57.375]&quot; --data_type FP16 --output_dir $OUTPUT_DIR
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">arguments</span><span class="p">:</span>
<span class="n">Common</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="n">to</span> <span class="n">the</span> <span class="n">Input</span> <span class="n">Model</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">resnet18_int8</span><span class="o">.</span><span class="n">onnx</span>
    <span class="o">-</span> <span class="n">Path</span> <span class="k">for</span> <span class="n">generated</span> <span class="n">IR</span><span class="p">:</span>    <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span>
    <span class="o">-</span> <span class="n">IR</span> <span class="n">output</span> <span class="n">name</span><span class="p">:</span>   <span class="n">resnet18_int8</span>
    <span class="o">-</span> <span class="n">Log</span> <span class="n">level</span><span class="p">:</span>    <span class="n">ERROR</span>
    <span class="o">-</span> <span class="n">Batch</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">layers</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Output</span> <span class="n">layers</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span><span class="p">,</span> <span class="n">inherited</span> <span class="kn">from</span> <span class="nn">the</span> <span class="n">model</span>
    <span class="o">-</span> <span class="n">Input</span> <span class="n">shapes</span><span class="p">:</span>     <span class="p">[</span><span class="mi">1</span><span class="p">,</span><span class="mi">3</span><span class="p">,</span> <span class="mi">64</span><span class="p">,</span> <span class="mi">64</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">Source</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Target</span> <span class="n">layout</span><span class="p">:</span>    <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Layout</span><span class="p">:</span>   <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Mean</span> <span class="n">values</span><span class="p">:</span>  <span class="p">[</span><span class="mf">123.675</span><span class="p">,</span> <span class="mf">116.28</span> <span class="p">,</span> <span class="mf">103.53</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">values</span><span class="p">:</span>     <span class="p">[</span><span class="mf">58.395</span><span class="p">,</span> <span class="mf">57.12</span> <span class="p">,</span> <span class="mf">57.375</span><span class="p">]</span>
    <span class="o">-</span> <span class="n">Scale</span> <span class="n">factor</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Precision</span> <span class="n">of</span> <span class="n">IR</span><span class="p">:</span>  <span class="n">FP16</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">fusing</span><span class="p">:</span>    <span class="kc">True</span>
    <span class="o">-</span> <span class="n">User</span> <span class="n">transformations</span><span class="p">:</span>     <span class="n">Not</span> <span class="n">specified</span>
    <span class="o">-</span> <span class="n">Reverse</span> <span class="nb">input</span> <span class="n">channels</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Enable</span> <span class="n">IR</span> <span class="n">generation</span> <span class="k">for</span> <span class="n">fixed</span> <span class="nb">input</span> <span class="n">shape</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Use</span> <span class="n">the</span> <span class="n">transformations</span> <span class="n">config</span> <span class="n">file</span><span class="p">:</span>  <span class="kc">None</span>
<span class="n">Advanced</span> <span class="n">parameters</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">legacy</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>   <span class="kc">False</span>
    <span class="o">-</span> <span class="n">Force</span> <span class="n">the</span> <span class="n">usage</span> <span class="n">of</span> <span class="n">new</span> <span class="n">Frontend</span> <span class="n">of</span> <span class="n">Model</span> <span class="n">Optimizer</span> <span class="k">for</span> <span class="n">model</span> <span class="n">conversion</span> <span class="n">into</span> <span class="n">IR</span><span class="p">:</span>  <span class="kc">False</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">found</span> <span class="ow">in</span><span class="p">:</span>  <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/.</span><span class="n">venv</span><span class="o">/</span><span class="n">lib</span><span class="o">/</span><span class="n">python3</span><span class="mf">.8</span><span class="o">/</span><span class="n">site</span><span class="o">-</span><span class="n">packages</span><span class="o">/</span><span class="n">openvino</span>
<span class="n">OpenVINO</span> <span class="n">runtime</span> <span class="n">version</span><span class="p">:</span>   <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="n">Model</span> <span class="n">Optimizer</span> <span class="n">version</span><span class="p">:</span>    <span class="mf">2022.1.0</span><span class="o">-</span><span class="mi">7019</span><span class="o">-</span><span class="n">cdb9bec7210</span><span class="o">-</span><span class="n">releases</span><span class="o">/</span><span class="mi">2022</span><span class="o">/</span><span class="mi">1</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Generated</span> <span class="n">IR</span> <span class="n">version</span> <span class="mi">11</span> <span class="n">model</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">XML</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">resnet18_int8</span><span class="o">.</span><span class="n">xml</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">BIN</span> <span class="n">file</span><span class="p">:</span> <span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="mi">302</span><span class="o">-</span><span class="n">pytorch</span><span class="o">-</span><span class="n">quantization</span><span class="o">-</span><span class="n">aware</span><span class="o">-</span><span class="n">training</span><span class="o">/</span><span class="n">output</span><span class="o">/</span><span class="n">resnet18_int8</span><span class="o">.</span><span class="n">bin</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Total</span> <span class="n">execution</span> <span class="n">time</span><span class="p">:</span> <span class="mf">0.91</span> <span class="n">seconds</span><span class="o">.</span>
<span class="p">[</span> <span class="n">SUCCESS</span> <span class="p">]</span> <span class="n">Memory</span> <span class="n">consumed</span><span class="p">:</span> <span class="mi">169</span> <span class="n">MB</span><span class="o">.</span>
<span class="n">It</span><span class="s1">&#39;s been a while, check for a new version of Intel(R) Distribution of OpenVINO(TM) toolkit here https://software.intel.com/content/www/us/en/develop/tools/openvino-toolkit/download.html?cid=other&amp;source=prod&amp;campid=ww_2022_bu_IOTG_OpenVINO-2022-1&amp;content=upg_all&amp;medium=organic or on the GitHub*</span>
<span class="p">[</span> <span class="n">INFO</span> <span class="p">]</span> <span class="n">The</span> <span class="n">model</span> <span class="n">was</span> <span class="n">converted</span> <span class="n">to</span> <span class="n">IR</span> <span class="n">v11</span><span class="p">,</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">model</span> <span class="nb">format</span> <span class="n">that</span> <span class="n">corresponds</span> <span class="n">to</span> <span class="n">the</span> <span class="n">source</span> <span class="n">DL</span> <span class="n">framework</span> <span class="nb">input</span><span class="o">/</span><span class="n">output</span> <span class="nb">format</span><span class="o">.</span> <span class="n">While</span> <span class="n">IR</span> <span class="n">v11</span> <span class="ow">is</span> <span class="n">backwards</span> <span class="n">compatible</span> <span class="k">with</span> <span class="n">OpenVINO</span> <span class="n">Inference</span> <span class="n">Engine</span> <span class="n">API</span> <span class="n">v1</span><span class="mf">.0</span><span class="p">,</span> <span class="n">please</span> <span class="n">use</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="p">(</span><span class="k">as</span> <span class="n">of</span> <span class="mf">2022.1</span><span class="p">)</span> <span class="n">to</span> <span class="n">take</span> <span class="n">advantage</span> <span class="n">of</span> <span class="n">the</span> <span class="n">latest</span> <span class="n">improvements</span> <span class="ow">in</span> <span class="n">IR</span> <span class="n">v11</span><span class="o">.</span>
<span class="n">Find</span> <span class="n">more</span> <span class="n">information</span> <span class="n">about</span> <span class="n">API</span> <span class="n">v2</span><span class="mf">.0</span> <span class="ow">and</span> <span class="n">IR</span> <span class="n">v11</span> <span class="n">at</span> <span class="n">https</span><span class="p">:</span><span class="o">//</span><span class="n">docs</span><span class="o">.</span><span class="n">openvino</span><span class="o">.</span><span class="n">ai</span>
</pre></div>
</div>
</section>
<section id="benchmark-model-performance-by-computing-inference-time">
<h2>Benchmark Model Performance by Computing Inference Time<a class="headerlink" href="#benchmark-model-performance-by-computing-inference-time" title="Permalink to this headline">¶</a></h2>
<p>Finally, measure the inference performance of the <code class="docutils literal notranslate"><span class="pre">FP32</span></code> and <code class="docutils literal notranslate"><span class="pre">INT8</span></code>
models, using <a class="reference external" href="https://docs.openvino.ai/latest/openvino_inference_engine_tools_benchmark_tool_README.html">Benchmark
Tool</a>
- inference performance measurement tool in OpenVINO. By default,
Benchmark Tool runs inference for 60 seconds in asynchronous mode on
CPU. It returns inference speed as latency (milliseconds per image) and
throughput (frames per second) values.</p>
<blockquote>
<div><p><strong>NOTE</strong>: This notebook runs <code class="docutils literal notranslate"><span class="pre">benchmark_app</span></code> for 15 seconds to give
a quick indication of performance. For more accurate performance, it
is recommended to run <code class="docutils literal notranslate"><span class="pre">benchmark_app</span></code> in a terminal/command prompt
after closing other applications. Run
<code class="docutils literal notranslate"><span class="pre">benchmark_app</span> <span class="pre">-m</span> <span class="pre">model.xml</span> <span class="pre">-d</span> <span class="pre">CPU</span></code> to benchmark async inference on
CPU for one minute. Change CPU to GPU to benchmark on GPU. Run
<code class="docutils literal notranslate"><span class="pre">benchmark_app</span> <span class="pre">--help</span></code> to see an overview of all command-line
options.</p>
</div></blockquote>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def parse_benchmark_output(benchmark_output):
    parsed_output = [line for line in benchmark_output if not (line.startswith(r&quot;[&quot;) or line.startswith(&quot;  &quot;) or line == &quot;&quot;)]
    print(*parsed_output, sep=&#39;\n&#39;)


print(&#39;Benchmark FP32 model (IR)&#39;)
benchmark_output = ! benchmark_app -m $fp32_ir_path -d CPU -api async -t 15
parse_benchmark_output(benchmark_output)

print(&#39;Benchmark INT8 model (IR)&#39;)
benchmark_output = ! benchmark_app -m $int8_ir_path -d CPU -api async -t 15
parse_benchmark_output(benchmark_output)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Benchmark</span> <span class="n">FP32</span> <span class="n">model</span> <span class="p">(</span><span class="n">IR</span><span class="p">)</span>
<span class="n">Count</span><span class="p">:</span>          <span class="mi">37554</span> <span class="n">iterations</span>
<span class="n">Duration</span><span class="p">:</span>       <span class="mf">15003.86</span> <span class="n">ms</span>
<span class="n">Latency</span><span class="p">:</span>
<span class="n">Throughput</span><span class="p">:</span> <span class="mf">2502.96</span> <span class="n">FPS</span>
<span class="n">Benchmark</span> <span class="n">INT8</span> <span class="n">model</span> <span class="p">(</span><span class="n">IR</span><span class="p">)</span>
<span class="n">Count</span><span class="p">:</span>          <span class="mi">133128</span> <span class="n">iterations</span>
<span class="n">Duration</span><span class="p">:</span>       <span class="mf">15000.73</span> <span class="n">ms</span>
<span class="n">Latency</span><span class="p">:</span>
<span class="n">Throughput</span><span class="p">:</span> <span class="mf">8874.77</span> <span class="n">FPS</span>
</pre></div>
</div>
<p>Show CPU Information for reference.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ie = Core()
ie.get_property(&quot;CPU&quot;, &quot;FULL_DEVICE_NAME&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;Intel(R) Core(TM) i9-10920X CPU @ 3.50GHz&#39;</span>
</pre></div>
</div>
</section>
</section>


                </div>
            
            
                <div class='prev-next-bottom'>
                  
    <a class='button bttn-sec button-size-l' id="prev-link" href="301-tensorflow-training-openvino-with-output.html" title="previous page">Prev</a>
    <a class='button bttn-sec button-size-l' id="next-link" href="305-tensorflow-quantization-aware-training-with-output.html" title="next page">Next</a>

                </div>
            
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Intel®.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>