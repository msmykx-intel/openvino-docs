
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Notebook Utils &#8212; OpenVINO™  documentation</title>
    
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/tabs.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    <link rel="stylesheet" type="text/css" href="../_static/doxyrest-pygments.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <link href="../_static/css/media/favicon.ico" rel="shortcut icon">
    <link rel="stylesheet" href="../_static/css/openvino_sphinx_theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/button.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/input.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/textfield.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/tabs.css" type="text/css" />
    <script src="../_static/js/openvino_sphinx_theme.js"></script>
    <link rel="stylesheet" href="../_static/css/viewer.min.css" type="text/css" />
    <link rel="stylesheet" href="../_static/css/custom.css" type="text/css" />

    <script src="https://cdn.jsdelivr.net/npm/chart.js@2.9.3/dist/Chart.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chartjs-plugin-annotation/0.5.7/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-barchart-background@1.3.0/build/Plugin.Barchart.Background.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-deferred@1"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.1/papaparse.min.js"></script>
    <script src="../_static/js/viewer.min.js"></script>
    <script src="/assets/versions_raw.js"></script>

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/tabs.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/js/custom.js"></script>
    <script src="../_static/js/graphs.js"></script>
    <script src="../_static/js/graphs_ov_tf.js"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/target-highlight.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <link rel="canonical" href="https://docs.openvino.ai/latest/notebooks/notebook_utils-with-output.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="API Reference" href="../api/api_reference.html" />
    <link rel="prev" title="PaddleOCR with OpenVINO™" href="405-paddle-ocr-webcam-with-output.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
      <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/logo.svg" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/get-started-guide.html">
  Get Started
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/documentation.html">
  Documentation
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../tutorials.html">
  Tutorials
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../api/api_reference.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../model_zoo.html">
  Model Zoo
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../pages/resources.html">
  Resources
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/openvinotoolkit/openvino" rel="noopener" target="_blank" title="GitHub">
            <span><i class="sst-github"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
</ul>
      </div>
      
      <div class="navbar-end-item">
        
<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="version-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"></button>
  <div class="dropdown-menu" aria-labelledby="version-selector">
  </div>
</div>
      </div>
      
      <div class="navbar-end-item">
        

<div class="dropdown sst-dropdown sst-dropdown-navbar">
  <button class="btn sst-btn dropdown-toggle" type="button" id="language-selector" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">English</button>
  <div class="dropdown-menu" aria-labelledby="language-selector">
    
      
        <a class="dropdown-item font-weight-bold" href="/openvino-docs/index.html">English</a>
      
    
      
        <a  class="dropdown-item" href="/cn/openvino-docs/index.html">Chinese</a>
      
    
  </div>
</div>

      </div>
      
    </div>
  </div>
</div>
        <div id="collapse-nav-wrapper" class="container-xl">
          <button id="collapse-nav" class="button bttn-prm button-size-m" type="button" data-toggle="collapse" data-target="#nav-tree" aria-expanded="false" aria-controls="nav-tree">
            Documentation navigation <i class="fas fa-chevron-down"></i>
          </button>
        </div>
      </nav>
      <div class="transition-banner container-fluid alert alert-info alert-dismissible fade show" role="alert">
        <p>OpenVINO 2022.1 introduces a new version of OpenVINO API (API 2.0). For more information on the changes and transition steps, see the <a href="https://docs.openvino.ai/latest/openvino_2_0_transition_guide.html">transition guide</a></p>
        <button type="button" class="close" data-dismiss="alert" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
    </div>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar" id="nav-tree"><form class="searchForm bd-search d-flex align-items-center" action="../search.html" method="get">
    <i class="icon fas fa-search"></i>
    <input type="search" class="form-control" name="query" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Notebooks
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../notebooks-installation.html">
   Installation of OpenVINO™ Notebooks
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="001-hello-world-with-output.html">
   Hello Image Classification
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="002-openvino-api-with-output.html">
   OpenVINO™ Runtime API Tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="003-hello-segmentation-with-output.html">
   Hello Image Segmentation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="004-hello-detection-with-output.html">
   Hello Object Detection
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="101-tensorflow-to-openvino-with-output.html">
   Convert a TensorFlow Model to OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="102-pytorch-onnx-to-openvino-with-output.html">
   Convert a PyTorch Model to ONNX and OpenVINO™ IR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="103-paddle-onnx-to-openvino-classification-with-output.html">
   Convert a PaddlePaddle Model to ONNX and OpenVINO™ IR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="104-model-tools-with-output.html">
   Working with Open Model Zoo Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="105-language-quantize-bert-with-output.html">
   Quantize NLP models with Post-Training Optimization Tool ​in OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="106-auto-device-with-output.html">
   Automatic Device Selection with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="107-speech-recognition-quantization-with-output.html">
   Quantize Speech Recognition Models with OpenVINO™ Post-Training Optimization Tool ​
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="110-ct-segmentation-quantize-nncf-with-output.html">
   Quantize a Segmentation Model and Show Live Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="110-ct-segmentation-quantize-with-output.html">
   Quantize a Segmentation Model and Show Live Inference
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="111-detection-quantization-with-output.html">
   Object Detection Quantization
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="112-pytorch-post-training-quantization-nncf-with-output.html">
   Post-Training Quantization of PyTorch models with NNCF
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="113-image-classification-quantization-with-output.html">
   Quantization of Image Classification Models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="114-quantization-simplified-mode-with-output.html">
   INT8 Quantization with Post-training Optimization Tool (POT) in Simplified Mode tutorial
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="115-async-api-with-output.html">
   Asynchronous Inference with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="201-vision-monodepth-with-output.html">
   Monodepth Estimation with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="202-vision-superresolution-image-with-output.html">
   Single Image Super Resolution with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="202-vision-superresolution-video-with-output.html">
   Video Super Resolution with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="203-meter-reader-with-output.html">
   Industrial Meter Reader
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="204-named-entity-recognition-with-output.html">
   Document Entity Extraction with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="205-vision-background-removal-with-output.html">
   Image Background Removal with U^2-Net and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="206-vision-paddlegan-anime-with-output.html">
   Photos to Anime with PaddleGAN and OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="207-vision-paddlegan-superresolution-with-output.html">
   Super Resolution with PaddleGAN and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="208-optical-character-recognition-with-output.html">
   Optical Character Recognition (OCR) with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="209-handwritten-ocr-with-output.html">
   Handwritten Chinese and Japanese OCR with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="210-ct-scan-live-inference-with-output.html">
   Live Inference and Benchmark CT-scan Data with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="211-speech-to-text-with-output.html">
   Speech to Text with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="212-onnx-style-transfer-with-output.html">
   Style Transfer on ONNX Models with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="214-vision-paddle-classification-with-output.html">
   PaddlePaddle Image Classification with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="215-image-inpainting-with-output.html">
   Image In-painting with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="216-license-plate-recognition-with-output.html">
   License Plate Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="217-vision-deblur-with-output.html">
   Deblur Photos with DeblurGAN-v2 and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="218-vehicle-detection-and-recognition-with-output.html">
   Vehicle Detection And Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="219-knowledge-graphs-conve-with-output.html">
   OpenVINO optimizations for Knowledge graphs
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="220-yolov5-accuracy-check-and-quantization-with-output.html">
   Quantize the Ultralytics YOLOv5 model and check accuracy using the OpenVINO POT API
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="221-machine-translation-with-output.html">
   Machine translation demo
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="222-vision-image-colorization-with-output.html">
   Image Colorization with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="223-gpt2-text-prediction-with-output.html">
   GPT-2 Text Prediction with OpenVINO
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="301-tensorflow-training-openvino-pot-with-output.html">
   Post-Training Quantization with TensorFlow Classification Model
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="301-tensorflow-training-openvino-with-output.html">
   From Training to Deployment with TensorFlow and OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="302-pytorch-quantization-aware-training-with-output.html">
   Quantization Aware Training with NNCF, using PyTorch framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="305-tensorflow-quantization-aware-training-with-output.html">
   Quantization Aware Training with NNCF, using TensorFlow Framework
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="401-object-detection-with-output.html">
   Live Object Detection with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="402-pose-estimation-with-output.html">
   Live Human Pose Estimation with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="403-action-recognition-webcam-with-output.html">
   Human Action Recognition with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="405-paddle-ocr-webcam-with-output.html">
   PaddleOCR with OpenVINO™
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Notebook Utils
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#files">
   Files
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-file-functions">
     Test File Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#images">
   Images
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#convert-pixel-data">
     Convert Pixel Data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-data-conversion-functions">
     Test Data Conversion Functions
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#videos">
   Videos
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#video-player">
     Video Player
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-video-player">
     Test Video Player
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualization">
   Visualization
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#segmentation">
     Segmentation
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#network-results">
     Network Results
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-visualization-functions">
     Test Visualization Functions
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#live-inference">
     Live Inference
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#test-live-inference">
       Test Live Inference
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#openvino-tools">
   OpenVINO Tools
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-openvino-tools">
     Test OpenVINO Tools
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#checks-and-alerts">
   Checks and Alerts
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#test-alerts">
     Test Alerts
    </a>
   </li>
  </ul>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                <div class="tocsection download-docs">
  <div class="dropdown sst-dropdown">
    <button class="button bttn-prm button-size-m" data-display="static" type="button" id="download-options"
      data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
      Download Docs
    </button>
    <div class="dropdown-menu" aria-labelledby="download-options">
      <a class="dropdown-item" href="#" onclick="window.print()">.pdf</a>
      <a id="download-zip-btn" class="dropdown-item" href="#">.zip</a>
    </div>
  </div>
</div>
              </div>
              
            
          </div>
          

          
          
              
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">

<div class="tocsection editthispage">
    <a href="None">
        <i class="fas fa-pencil-alt"></i> Edit this page
    </a>
</div>

            
                <div>
                  
  <section id="notebook-utils">
<h1>Notebook Utils<a class="headerlink" href="#notebook-utils" title="Permalink to this headline">¶</a></h1>
<p>This notebook contains helper functions and classes for use with
OpenVINO™ Notebooks. The code is synchronized with the
<code class="docutils literal notranslate"><span class="pre">notebook_utils.py</span></code> file in the same directory as this notebook.</p>
<p>There are five categories:</p>
<ul class="simple">
<li><p><a class="reference external" href="#Files">Files</a></p></li>
<li><p><a class="reference external" href="#Images">Images</a></p></li>
<li><p><a class="reference external" href="#Videos">Videos</a></p></li>
<li><p><a class="reference external" href="#Visualization">Visualization</a></p></li>
<li><p><a class="reference external" href="#OpenVINO-Tools">OpenVINO Tools</a></p></li>
<li><p><a class="reference external" href="#Checks-and-Alerts">Checks and Alerts</a></p></li>
</ul>
<p>Each category contains a test cell that also shows how to use the
functions in the section.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>import os
import shutil
import socket
import threading
import time
import urllib
import urllib.parse
import urllib.request
from os import PathLike
from pathlib import Path
from typing import Callable, List, NamedTuple, Optional, Tuple

import cv2
import matplotlib
import matplotlib.pyplot as plt
import numpy as np
import openvino.inference_engine
from async_pipeline import AsyncPipeline
from IPython.display import HTML, Image, Markdown, clear_output, display
from matplotlib.lines import Line2D
from models import model
from openvino.inference_engine import IECore
from tqdm.notebook import tqdm_notebook
</pre></div>
</div>
<section id="files">
<h2>Files<a class="headerlink" href="#files" title="Permalink to this headline">¶</a></h2>
<p>Load an image, download a file, download an OpenVINO IR model, and
create a progress bar to show download progress.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def load_image(path: str) -&gt; np.ndarray:
    &quot;&quot;&quot;
    Loads an image from `path` and returns it as BGR numpy array. The `path` variable
    should point to an image file, either a local filename or a url. The image is
    not stored to the filesystem. Use the `download_file` function to download and
    store an image.

    :param path: Local path name or URL to image.
    :return: image as BGR numpy array
    &quot;&quot;&quot;
    if path.startswith(&quot;http&quot;):
        # Set User-Agent to Mozilla because some websites block
        # requests with User-Agent Python.
        request = urllib.request.Request(path, headers={&quot;User-Agent&quot;: &quot;Mozilla/5.0&quot;})
        response = urllib.request.urlopen(request)
        array = np.asarray(bytearray(response.read()), dtype=&quot;uint8&quot;)
        image = cv2.imdecode(array, -1)  # Loads the image as BGR.
    else:
        image = cv2.imread(path)
    return image


class DownloadProgressBar(tqdm_notebook):
    &quot;&quot;&quot;
    TQDM Progress bar for downloading files with urllib.request.urlretrieve
    &quot;&quot;&quot;

    def update_to(self, block_num: int, block_size: int, total_size: int):
        downloaded = block_num * block_size
        if downloaded &lt;= total_size:
            self.update(downloaded - self.n)


def download_file(
    url: PathLike,
    filename: PathLike = None,
    directory: PathLike = None,
    show_progress: bool = True,
    silent: bool = False,
    timeout: int = 10,
) -&gt; str:
    &quot;&quot;&quot;
    Download a file from a url and save it to the local filesystem. The file is saved to the
    current directory by default, or to `directory` if specified. If a filename is not given,
    the filename of the URL will be used.

    :param url: URL that points to the file to download.
    :param filename: A name of the local file to save. It should point to the name of the file only,
                     not the full path. If set to None, the filename from the url will be used
    :param directory: A directory to save the file to. It will be created if it does not exist
                      If set to None, the file will be saved to the current working directory.
    :param show_progress: If set to True, shows an TQDM ProgressBar.
    :param silent: If set to True, does not print a message if the file already exists.
    :param timeout: number of seconds before cancelling the connection attempt
    :return: path to downloaded file
    &quot;&quot;&quot;
    try:
        opener = urllib.request.build_opener()
        opener.addheaders = [(&quot;User-agent&quot;, &quot;Mozilla/5.0&quot;)]
        urllib.request.install_opener(opener)
        urlobject = urllib.request.urlopen(url, timeout=timeout)
        if filename is None:
            filename = urlobject.info().get_filename() or Path(urllib.parse.urlparse(url).path).name
    except urllib.error.HTTPError as e:
        raise Exception(f&quot;File downloading failed with error: {e.code} {e.msg}&quot;) from None
    except urllib.error.URLError as error:
        if isinstance(error.reason, socket.timeout):
            raise Exception(
                &quot;Connection timed out. If you access the internet through a proxy server, &quot;
                &quot;make sure the proxy is set in the shell from where you launched Jupyter. If your &quot;
                &quot;internet connection is slow, you can call `download_file(url, timeout=30)` to &quot;
                &quot;wait for 30 seconds before raising this error.&quot;
            ) from None
        else:
            raise

    filename = Path(filename)
    if len(filename.parts) &gt; 1:
        raise ValueError(
            &quot;The `filename` parameter should refer to the name of the file, excluding the directory. &quot;
            &quot;Use the `directory` parameter to specify a target directory for the downloaded file.&quot;
        )

    # Create the directory if it does not exist, and add the directory to the filename.
    if directory is not None:
        directory = Path(directory)
        directory.mkdir(parents=True, exist_ok=True)
        filename = directory / Path(filename)

    # Download the file if it does not exist, or if it exists with an incorrect file size.
    urlobject_size = int(urlobject.info().get(&quot;Content-Length&quot;, 0))
    if not filename.exists() or (os.stat(filename).st_size != urlobject_size):
        progress_callback = DownloadProgressBar(
            total=urlobject_size,
            unit=&quot;B&quot;,
            unit_scale=True,
            unit_divisor=1024,
            desc=str(filename),
            disable=not show_progress,
        )
        urllib.request.urlretrieve(url, filename, reporthook=progress_callback.update_to)
        if os.stat(filename).st_size &gt;= urlobject_size:
            progress_callback.update(urlobject_size - progress_callback.n)
            progress_callback.refresh()
    else:
        if not silent:
            print(f&quot;&#39;{filename}&#39; already exists.&quot;)
    return filename.resolve()


def download_ir_model(model_xml_url: str, destination_folder: PathLike = None) -&gt; PathLike:
    &quot;&quot;&quot;
    Download OpenVINO IR model from `model_xml_url`. Downloads xml and bin file of the model; the weights file is
    assumed to exist at the same location and name as `model_xml_url` with a &quot;.bin&quot; extension.

    :param model_xml_url: The URL to xml file of the model to download.
    :param destination_folder: A directory where downloaded xml and bin files of the model are saved. If set to None, model
                               files are saved to the current directory.
    :return: The path to downloaded xml file of the model.
    &quot;&quot;&quot;
    model_bin_url = model_xml_url[:-4] + &quot;.bin&quot;
    model_xml_path = download_file(model_xml_url, directory=destination_folder, show_progress=False)
    download_file(model_bin_url, directory=destination_folder)
    return model_xml_path
</pre></div>
</div>
<section id="test-file-functions">
<h3>Test File Functions<a class="headerlink" href="#test-file-functions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>model_url = &quot;https://github.com/openvinotoolkit/openvino_notebooks/raw/main/notebooks/002-openvino-api/model/segmentation.xml&quot;
download_ir_model(model_url, &quot;model&quot;)

assert os.path.exists(&quot;model/segmentation.xml&quot;)
assert os.path.exists(&quot;model/segmentation.bin&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>model/segmentation.bin:   0%|          | 0.00/1.09M [00:00&lt;?, ?B/s]
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>url = &quot;https://github.com/intel-iot-devkit/safety-gear-detector-python/raw/master/resources/Safety_Full_Hat_and_Vest.mp4&quot;
if os.path.exists(os.path.basename(url)):
    os.remove(os.path.basename(url))
video_file = download_file(url)
print(video_file)
assert Path(video_file).exists()
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>Safety_Full_Hat_and_Vest.mp4:   0%|          | 0.00/26.3M [00:00&lt;?, ?B/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">Safety_Full_Hat_and_Vest</span><span class="o">.</span><span class="n">mp4</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>url = &quot;https://raw.githubusercontent.com/openvinotoolkit/openvino_notebooks/main/README.md&quot;
filename = &quot;openvino_notebooks_readme.md&quot;
if os.path.exists(filename):
    os.remove(filename)
readme_file = download_file(url, filename=filename)
print(readme_file)
assert Path(readme_file).exists()
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>openvino_notebooks_readme.md:   0%|          | 0.00/35.5k [00:00&lt;?, ?B/s]
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">openvino_notebooks_readme</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>url = &quot;https://raw.githubusercontent.com/openvinotoolkit/openvino_notebooks/main/README.md&quot;
filename = &quot;openvino_notebooks_readme.md&quot;
directory = &quot;temp&quot;
video_file = download_file(
    url, filename=filename, directory=directory, show_progress=False, silent=True
)
print(readme_file)
assert Path(readme_file).exists()
shutil.rmtree(&quot;temp&quot;)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">/</span><span class="n">opt</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">k8sworker</span><span class="o">/</span><span class="n">cibuilds</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">OVNotebookOps</span><span class="o">-</span><span class="mi">231</span><span class="o">/.</span><span class="n">workspace</span><span class="o">/</span><span class="n">scm</span><span class="o">/</span><span class="n">ov</span><span class="o">-</span><span class="n">notebook</span><span class="o">/</span><span class="n">notebooks</span><span class="o">/</span><span class="n">utils</span><span class="o">/</span><span class="n">openvino_notebooks_readme</span><span class="o">.</span><span class="n">md</span>
</pre></div>
</div>
</section>
</section>
<section id="images">
<h2>Images<a class="headerlink" href="#images" title="Permalink to this headline">¶</a></h2>
<section id="convert-pixel-data">
<h3>Convert Pixel Data<a class="headerlink" href="#convert-pixel-data" title="Permalink to this headline">¶</a></h3>
<p>Normalize image pixel values between 0 and 1, and convert images to
<code class="docutils literal notranslate"><span class="pre">RGB</span></code> and <code class="docutils literal notranslate"><span class="pre">BGR</span></code>.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def normalize_minmax(data):
    &quot;&quot;&quot;
    Normalizes the values in `data` between 0 and 1
    &quot;&quot;&quot;
    if data.max() == data.min():
        raise ValueError(
            &quot;Normalization is not possible because all elements of&quot;
            f&quot;`data` have the same value: {data.max()}.&quot;
        )
    return (data - data.min()) / (data.max() - data.min())


def to_rgb(image_data: np.ndarray) -&gt; np.ndarray:
    &quot;&quot;&quot;
    Convert image_data from BGR to RGB.
    &quot;&quot;&quot;
    return cv2.cvtColor(image_data, cv2.COLOR_BGR2RGB)


def to_bgr(image_data: np.ndarray) -&gt; np.ndarray:
    &quot;&quot;&quot;
    Convert image_data from RGB to BGR.
    &quot;&quot;&quot;
    return cv2.cvtColor(image_data, cv2.COLOR_RGB2BGR)
</pre></div>
</div>
</section>
<section id="test-data-conversion-functions">
<h3>Test Data Conversion Functions<a class="headerlink" href="#test-data-conversion-functions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>test_array = np.random.randint(0, 255, (100, 100, 3))
normalized_array = normalize_minmax(test_array)

assert normalized_array.min() == 0
assert normalized_array.max() == 1
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>bgr_array = np.ones((100, 100, 3), dtype=np.uint8)
bgr_array[:, :, 0] = 0
bgr_array[:, :, 1] = 1
bgr_array[:, :, 2] = 2
rgb_array = to_rgb(bgr_array)

assert np.all(bgr_array[:, :, 0] == rgb_array[:, :, 2])

bgr_array_converted = to_bgr(rgb_array)
assert np.all(bgr_array_converted == bgr_array)
</pre></div>
</div>
</section>
</section>
<section id="videos">
<h2>Videos<a class="headerlink" href="#videos" title="Permalink to this headline">¶</a></h2>
<section id="video-player">
<h3>Video Player<a class="headerlink" href="#video-player" title="Permalink to this headline">¶</a></h3>
<p>A custom video player to fulfill FPS requirements. You can set target
FPS and output size, flip the video horizontally or skip first N frames.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class VideoPlayer:
    &quot;&quot;&quot;
    Custom video player to fulfill FPS requirements. You can set target FPS and output size,
    flip the video horizontally or skip first N frames.

    :param source: Video source. It could be either camera device or video file.
    :param size: Output frame size.
    :param flip: Flip source horizontally.
    :param fps: Target FPS.
    :param skip_first_frames: Skip first N frames.
    &quot;&quot;&quot;

    def __init__(self, source, size=None, flip=False, fps=None, skip_first_frames=0):
        self.__cap = cv2.VideoCapture(source)
        if not self.__cap.isOpened():
            raise RuntimeError(
                f&quot;Cannot open {&#39;camera&#39; if isinstance(source, int) else &#39;&#39;} {source}&quot;
            )
        # Skip first N frames.
        self.__cap.set(cv2.CAP_PROP_POS_FRAMES, skip_first_frames)
        # fps of input file
        self.__input_fps = self.__cap.get(cv2.CAP_PROP_FPS)
        if self.__input_fps &lt;= 0:
            self.__input_fps = 60
        # target fps given by user
        self.__output_fps = fps if fps is not None else self.__input_fps
        self.__flip = flip
        self.__size = None
        self.__interpolation = None
        if size is not None:
            self.__size = size
            # AREA better for shrinking, LINEAR better for enlarging
            self.__interpolation = (
                cv2.INTER_AREA
                if size[0] &lt; self.__cap.get(cv2.CAP_PROP_FRAME_WIDTH)
                else cv2.INTER_LINEAR
            )
        # first frame
        _, self.__frame = self.__cap.read()
        self.__lock = threading.Lock()
        self.__thread = None
        self.__stop = False

    &quot;&quot;&quot;
    Start playing.
    &quot;&quot;&quot;

    def start(self):
        self.__stop = False
        self.__thread = threading.Thread(target=self.__run, daemon=True)
        self.__thread.start()

    &quot;&quot;&quot;
    Stop playing and release resources.
    &quot;&quot;&quot;

    def stop(self):
        self.__stop = True
        if self.__thread is not None:
            self.__thread.join()
        self.__cap.release()

    def __run(self):
        prev_time = 0
        while not self.__stop:
            t1 = time.time()
            ret, frame = self.__cap.read()
            if not ret:
                break

            # Fulfill target fps.
            if 1 / self.__output_fps &lt; time.time() - prev_time:
                prev_time = time.time()
                # Replace by current frame.
                with self.__lock:
                    self.__frame = frame

            t2 = time.time()
            # time to wait [s] to fulfill input fps
            wait_time = 1 / self.__input_fps - (t2 - t1)
            # Wait until.
            time.sleep(max(0, wait_time))

        self.__frame = None

    &quot;&quot;&quot;
    Get current frame.
    &quot;&quot;&quot;

    def next(self):
        with self.__lock:
            if self.__frame is None:
                return None
            # Need to copy frame, because it can be cached and reused if fps is low.
            frame = self.__frame.copy()
        if self.__size is not None:
            frame = cv2.resize(frame, self.__size, interpolation=self.__interpolation)
        if self.__flip:
            frame = cv2.flip(frame, 1)
        return frame
</pre></div>
</div>
</section>
<section id="test-video-player">
<h3>Test Video Player<a class="headerlink" href="#test-video-player" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>video = &quot;../201-vision-monodepth/data/Coco Walking in Berkeley.mp4&quot;

player = VideoPlayer(video, fps=15, skip_first_frames=10)
player.start()
for i in range(50):
    frame = player.next()
    _, encoded_img = cv2.imencode(&quot;.jpg&quot;, frame, params=[cv2.IMWRITE_JPEG_QUALITY, 90])
    img = Image(data=encoded_img)
    clear_output(wait=True)
    display(img)

player.stop()
print(&quot;Finished&quot;)
</pre></div>
</div>
<img alt="../_images/notebook_utils-with-output_19_0.png" src="../_images/notebook_utils-with-output_19_0.png" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Finished</span>
</pre></div>
</div>
</section>
</section>
<section id="visualization">
<h2>Visualization<a class="headerlink" href="#visualization" title="Permalink to this headline">¶</a></h2>
<section id="segmentation">
<h3>Segmentation<a class="headerlink" href="#segmentation" title="Permalink to this headline">¶</a></h3>
<p>Define a <code class="docutils literal notranslate"><span class="pre">SegmentationMap</span> <span class="pre">NamedTuple</span></code> that keeps the labels and
colormap for a segmentation project/dataset. Create
<code class="docutils literal notranslate"><span class="pre">CityScapesSegmentation</span></code> and <code class="docutils literal notranslate"><span class="pre">BinarySegmentation</span> <span class="pre">SegmentationMaps</span></code>.
Create a function to convert a segmentation map to an <code class="docutils literal notranslate"><span class="pre">RGB</span></code> image with
a <code class="docutils literal notranslate"><span class="pre">colormap</span></code>, and to show the segmentation result as an overlay over
the original image.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class Label(NamedTuple):
    index: int
    color: Tuple
    name: Optional[str] = None
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class SegmentationMap(NamedTuple):
    labels: List

    def get_colormap(self):
        return np.array([label.color for label in self.labels])

    def get_labels(self):
        labelnames = [label.name for label in self.labels]
        if any(labelnames):
            return labelnames
        else:
            return None
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>cityscape_labels = [
    Label(index=0, color=(128, 64, 128), name=&quot;road&quot;),
    Label(index=1, color=(244, 35, 232), name=&quot;sidewalk&quot;),
    Label(index=2, color=(70, 70, 70), name=&quot;building&quot;),
    Label(index=3, color=(102, 102, 156), name=&quot;wall&quot;),
    Label(index=4, color=(190, 153, 153), name=&quot;fence&quot;),
    Label(index=5, color=(153, 153, 153), name=&quot;pole&quot;),
    Label(index=6, color=(250, 170, 30), name=&quot;traffic light&quot;),
    Label(index=7, color=(220, 220, 0), name=&quot;traffic sign&quot;),
    Label(index=8, color=(107, 142, 35), name=&quot;vegetation&quot;),
    Label(index=9, color=(152, 251, 152), name=&quot;terrain&quot;),
    Label(index=10, color=(70, 130, 180), name=&quot;sky&quot;),
    Label(index=11, color=(220, 20, 60), name=&quot;person&quot;),
    Label(index=12, color=(255, 0, 0), name=&quot;rider&quot;),
    Label(index=13, color=(0, 0, 142), name=&quot;car&quot;),
    Label(index=14, color=(0, 0, 70), name=&quot;truck&quot;),
    Label(index=15, color=(0, 60, 100), name=&quot;bus&quot;),
    Label(index=16, color=(0, 80, 100), name=&quot;train&quot;),
    Label(index=17, color=(0, 0, 230), name=&quot;motorcycle&quot;),
    Label(index=18, color=(119, 11, 32), name=&quot;bicycle&quot;),
    Label(index=19, color=(255, 255, 255), name=&quot;background&quot;),
]

CityScapesSegmentation = SegmentationMap(cityscape_labels)

binary_labels = [
    Label(index=0, color=(255, 255, 255), name=&quot;background&quot;),
    Label(index=1, color=(0, 0, 0), name=&quot;foreground&quot;),
]

BinarySegmentation = SegmentationMap(binary_labels)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def segmentation_map_to_image(
    result: np.ndarray, colormap: np.ndarray, remove_holes: bool = False
) -&gt; np.ndarray:
    &quot;&quot;&quot;
    Convert network result of floating point numbers to an RGB image with
    integer values from 0-255 by applying a colormap.

    :param result: A single network result after converting to pixel values in H,W or 1,H,W shape.
    :param colormap: A numpy array of shape (num_classes, 3) with an RGB value per class.
    :param remove_holes: If set to True, remove holes in the segmentation result.
    :return: An RGB image where each pixel is an int8 value according to colormap.
    &quot;&quot;&quot;
    if len(result.shape) != 2 and result.shape[0] != 1:
        raise ValueError(
            f&quot;Expected result with shape (H,W) or (1,H,W), got result with shape {result.shape}&quot;
        )

    if len(np.unique(result)) &gt; colormap.shape[0]:
        raise ValueError(
            f&quot;Expected max {colormap[0]} classes in result, got {len(np.unique(result))} &quot;
            &quot;different output values. Make sure to convert the network output to &quot;
            &quot;pixel values before calling this function.&quot;
        )
    elif result.shape[0] == 1:
        result = result.squeeze(0)

    result = result.astype(np.uint8)

    contour_mode = cv2.RETR_EXTERNAL if remove_holes else cv2.RETR_TREE
    mask = np.zeros((result.shape[0], result.shape[1], 3), dtype=np.uint8)
    for label_index, color in enumerate(colormap):
        label_index_map = result == label_index
        label_index_map = label_index_map.astype(np.uint8) * 255
        contours, hierarchies = cv2.findContours(
            label_index_map, contour_mode, cv2.CHAIN_APPROX_SIMPLE
        )
        cv2.drawContours(
            mask,
            contours,
            contourIdx=-1,
            color=color.tolist(),
            thickness=cv2.FILLED,
        )

    return mask


def segmentation_map_to_overlay(image, result, alpha, colormap, remove_holes=False) -&gt; np.ndarray:
    &quot;&quot;&quot;
    Returns a new image where a segmentation mask (created with colormap) is overlayed on
    the source image.

    :param image: Source image.
    :param result: A single network result after converting to pixel values in H,W or 1,H,W shape.
    :param alpha: Alpha transparency value for the overlay image.
    :param colormap: A numpy array of shape (num_classes, 3) with an RGB value per class.
    :param remove_holes: If set to True, remove holes in the segmentation result.
    :return: An RGP image with segmentation mask overlayed on the source image.
    &quot;&quot;&quot;
    if len(image.shape) == 2:
        image = np.repeat(np.expand_dims(image, -1), 3, 2)
    mask = segmentation_map_to_image(result, colormap, remove_holes)
    image_height, image_width = image.shape[:2]
    mask = cv2.resize(src=mask, dsize=(image_width, image_height))
    return cv2.addWeighted(mask, alpha, image, 1 - alpha, 0)
</pre></div>
</div>
</section>
<section id="network-results">
<h3>Network Results<a class="headerlink" href="#network-results" title="Permalink to this headline">¶</a></h3>
<p>Show network result image, optionally together with the source image and
a legend with labels.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def viz_result_image(
    result_image: np.ndarray,
    source_image: np.ndarray = None,
    source_title: str = None,
    result_title: str = None,
    labels: List[Label] = None,
    resize: bool = False,
    bgr_to_rgb: bool = False,
    hide_axes: bool = False,
) -&gt; matplotlib.figure.Figure:
    &quot;&quot;&quot;
    Show result image, optionally together with source images, and a legend with labels.

    :param result_image: Numpy array of RGB result image.
    :param source_image: Numpy array of source image. If provided, this image will be shown
                         next to the result image. The &#39;source_image&#39; is expected to be in RGB format.
                         Set `bgr_to_rgb` to True if `source_image` is in BGR format.
    :param source_title: Title to display for the source image.
    :param result_title: Title to display for the result image.
    :param labels: List of labels. If provided, a legend will be shown with the given labels.
    :param resize: If set to True, resize the result image to the same shape as the source image.
    :param bgr_to_rgb: If set to True, convert the source image from BGR to RGB. Use this option if
                       `source_image` is a BGR image.
    :param hide_axes: If set to True, do not show matplotlib axes.
    :return: Matplotlib figure with the result image.
    &quot;&quot;&quot;
    if bgr_to_rgb:
        source_image = to_rgb(source_image)
    if resize:
        result_image = cv2.resize(result_image, (source_image.shape[1], source_image.shape[0]))

    num_images = 1 if source_image is None else 2

    fig, ax = plt.subplots(1, num_images, figsize=(16, 8), squeeze=False)
    if source_image is not None:
        ax[0, 0].imshow(source_image)
        ax[0, 0].set_title(source_title)

    ax[0, num_images - 1].imshow(result_image)
    ax[0, num_images - 1].set_title(result_title)

    if hide_axes:
        for a in ax.ravel():
            a.axis(&quot;off&quot;)
    if labels:
        colors = labels.get_colormap()
        lines = [
            Line2D(
                [0],
                [0],
                color=[item / 255 for item in c.tolist()],
                linewidth=3,
                linestyle=&quot;-&quot;,
            )
            for c in colors
        ]
        plt.legend(
            lines,
            labels.get_labels(),
            bbox_to_anchor=(1, 1),
            loc=&quot;upper left&quot;,
            prop={&quot;size&quot;: 12},
        )
    plt.close(fig)
    return fig
</pre></div>
</div>
</section>
<section id="test-visualization-functions">
<h3>Test Visualization Functions<a class="headerlink" href="#test-visualization-functions" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>testimage = np.zeros((100, 100, 3), dtype=np.uint8)
testimage[30:80, 30:80, :] = [0, 255, 0]
testimage[0:10, 0:10, :] = 100
testimage[40:60, 40:60, :] = 128
testimage[testimage == 0] = 128


testmask1 = np.zeros((testimage.shape[:2]))
testmask1[30:80, 30:80] = 1
testmask1[40:50, 40:50] = 0
testmask1[0:15, 0:10] = 2

result_image_overlay = segmentation_map_to_overlay(
    image=testimage,
    result=testmask1,
    alpha=0.6,
    colormap=np.array([[0, 0, 0], [255, 0, 0], [255, 255, 0]]),
)
result_image = segmentation_map_to_image(testmask1, CityScapesSegmentation.get_colormap())
result_image_no_holes = segmentation_map_to_image(
    testmask1, CityScapesSegmentation.get_colormap(), remove_holes=True
)
resized_result_image = cv2.resize(result_image, (50, 50))
overlay_result_image = segmentation_map_to_overlay(
    testimage, testmask1, 0.6, CityScapesSegmentation.get_colormap(), remove_holes=False
)

fig1 = viz_result_image(result_image, testimage)
fig2 = viz_result_image(result_image_no_holes, testimage, labels=CityScapesSegmentation)
fig3 = viz_result_image(
    resized_result_image,
    testimage,
    source_title=&quot;Source Image&quot;,
    result_title=&quot;Resized Result Image&quot;,
    resize=True,
)
fig4 = viz_result_image(
    overlay_result_image,
    labels=CityScapesSegmentation,
    result_title=&quot;Image with Result Overlay&quot;,
)

display(fig1, fig2, fig3, fig4)
</pre></div>
</div>
<img alt="../_images/notebook_utils-with-output_29_0.png" src="../_images/notebook_utils-with-output_29_0.png" />
<img alt="../_images/notebook_utils-with-output_29_1.png" src="../_images/notebook_utils-with-output_29_1.png" />
<img alt="../_images/notebook_utils-with-output_29_2.png" src="../_images/notebook_utils-with-output_29_2.png" />
<img alt="../_images/notebook_utils-with-output_29_3.png" src="../_images/notebook_utils-with-output_29_3.png" />
</section>
<section id="live-inference">
<h3>Live Inference<a class="headerlink" href="#live-inference" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def showarray(frame: np.ndarray, display_handle=None):
    &quot;&quot;&quot;
    Display `frame` array. Replace information at `display_handle` with `frame`
    encoded as jpeg image. The `frame` array is expected to have data in BGR order.

    Create a `display_handle` with: `display_handle = display(display_id=True)`
    &quot;&quot;&quot;
    _, frame = cv2.imencode(ext=&quot;.jpeg&quot;, img=frame)
    if display_handle is None:
        display_handle = display(Image(data=frame.tobytes()), display_id=True)
    else:
        display_handle.update(Image(data=frame.tobytes()))
    return display_handle


def show_live_inference(
    ie, image_paths: List, model: model.Model, device: str, reader: Optional[Callable] = None
):
    &quot;&quot;&quot;
    Do inference of images listed in `image_paths` on `model` on the given `device` and show
    the results in real time in a Jupyter Notebook.

    :param image_paths: List of image filenames to load.
    :param model: Model instance for inference.
    :param device: Name of device to perform inference on. For example: &quot;CPU&quot;.
    :param reader: Image reader. Should return a numpy array with image data.
                   If set to None, `cv2.imread` will be used, with the `cv2.IMREAD_UNCHANGED` flag.
    &quot;&quot;&quot;
    display_handle = None
    next_frame_id = 0
    next_frame_id_to_show = 0

    input_layer = next(iter(model.net.input_info))

    # Create asynchronous pipeline and print time it takes to load the model.
    load_start_time = time.perf_counter()
    pipeline = AsyncPipeline(
        ie=ie, model=model, plugin_config={}, device=device, max_num_requests=0
    )
    load_end_time = time.perf_counter()

    # Perform asynchronous inference.
    start_time = time.perf_counter()

    while next_frame_id &lt; len(image_paths) - 1:
        results = pipeline.get_result(next_frame_id_to_show)

        if results:
            # Show next result from async pipeline.
            result, meta = results
            display_handle = showarray(result, display_handle)
            next_frame_id_to_show += 1
        if pipeline.is_ready():
            # Submit a new image to async pipeline.
            image_path = image_paths[next_frame_id]
            if reader is None:
                image = cv2.imread(filename=str(image_path), flags=cv2.IMREAD_UNCHANGED)
            else:
                image = reader(str(image_path))
            pipeline.submit_data(
                inputs={input_layer: image}, id=next_frame_id, meta={&quot;frame&quot;: image}
            )
            del image
            next_frame_id += 1
        else:
            # If the pipeline is not ready yet and there are no results: wait.
            pipeline.await_any()

    pipeline.await_all()

    # Show all frames that are in the pipeline after all images have been submitted.
    while pipeline.has_completed_request():
        results = pipeline.get_result(next_frame_id_to_show)
        if results:
            result, meta = results
            display_handle = showarray(result, display_handle)
            next_frame_id_to_show += 1

    end_time = time.perf_counter()
    duration = end_time - start_time
    fps = len(image_paths) / duration
    print(f&quot;Loaded model to {device} in {load_end_time-load_start_time:.2f} seconds.&quot;)
    print(f&quot;Total time for {next_frame_id} frames: {duration:.2f} seconds, fps:{fps:.2f}&quot;)

    del pipeline.exec_net
    del pipeline
</pre></div>
</div>
<section id="test-live-inference">
<h4>Test Live Inference<a class="headerlink" href="#test-live-inference" title="Permalink to this headline">¶</a></h4>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Test binary segmentation
from models.custom_segmentation import SegmentationModel

image_paths = sorted(list(Path(&quot;../111-detection-quantization/data&quot;).glob(&quot;*.jpg&quot;)))

ie = IECore()
segmentation_model = SegmentationModel(
    ie,
    Path(&quot;model/segmentation.xml&quot;),
    sigmoid=False,
    colormap=np.array([[0, 0, 0], [0, 0, 255]]),
    rgb=True,
    rotate_and_flip=False,
)

show_live_inference(
    ie=ie,
    image_paths=image_paths,
    model=segmentation_model,
    device=&quot;CPU&quot;,
    reader=lambda x: cv2.cvtColor(cv2.imread(x), cv2.COLOR_BGR2RGB),
)
</pre></div>
</div>
<img alt="../_images/notebook_utils-with-output_33_0.jpg" src="../_images/notebook_utils-with-output_33_0.jpg" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Loaded</span> <span class="n">model</span> <span class="n">to</span> <span class="n">CPU</span> <span class="ow">in</span> <span class="mf">0.71</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">Total</span> <span class="n">time</span> <span class="k">for</span> <span class="mi">9</span> <span class="n">frames</span><span class="p">:</span> <span class="mf">0.46</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span><span class="mf">21.96</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span># Test multiclass segmentation with different input shape.
# This requires running the 102 notebook first, to generate the Fastseg model.

fastseg_path = Path(&quot;../102-pytorch-onnx-to-openvino/model/fastseg1024.xml&quot;)
image_path = &quot;../102-pytorch-onnx-to-openvino/data/street.jpg&quot;

if fastseg_path.exists():
    image_paths = [
        image_path,
    ] * 5

    ie = IECore()
    CityScapesSegmentation = SegmentationMap(cityscape_labels)
    segmentation_model = SegmentationModel(
        ie,
        fastseg_path,
        sigmoid=False,
        argmax=True,
        colormap=CityScapesSegmentation.get_colormap(),
        rgb=True,
    )
    show_live_inference(ie=ie, image_paths=image_paths, model=segmentation_model, device=&quot;CPU&quot;)
</pre></div>
</div>
<img alt="../_images/notebook_utils-with-output_34_0.jpg" src="../_images/notebook_utils-with-output_34_0.jpg" />
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Loaded</span> <span class="n">model</span> <span class="n">to</span> <span class="n">CPU</span> <span class="ow">in</span> <span class="mf">0.22</span> <span class="n">seconds</span><span class="o">.</span>
<span class="n">Total</span> <span class="n">time</span> <span class="k">for</span> <span class="mi">4</span> <span class="n">frames</span><span class="p">:</span> <span class="mf">1.26</span> <span class="n">seconds</span><span class="p">,</span> <span class="n">fps</span><span class="p">:</span><span class="mf">3.97</span>
</pre></div>
</div>
</section>
</section>
</section>
<section id="openvino-tools">
<h2>OpenVINO Tools<a class="headerlink" href="#openvino-tools" title="Permalink to this headline">¶</a></h2>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>def benchmark_model(
    model_path: PathLike,
    device: str = &quot;CPU&quot;,
    seconds: int = 60,
    api: str = &quot;async&quot;,
    batch: int = 1,
    cache_dir: PathLike = &quot;model_cache&quot;,
):
    &quot;&quot;&quot;
    Benchmark model specified in `model_path` with `benchmark_app`. Returns the output of `benchmark_app`
    without logging info, and information about the device.

    :param model_path: The path to an xml file of the OpenVINO IR model, or ONNX model.
    :param device: A device to benchmark on. For example, &quot;CPU&quot; or &quot;MULTI:CPU,GPU&quot;.
    :param seconds: A number of seconds to run benchmark_app.
    :param api: API. Possible options: sync or async.
    :param batch: Batch size.
    :param cache_dir: A directory that contains model/kernel cache files.
    &quot;&quot;&quot;
    ie = IECore()
    model_path = Path(model_path)
    if (&quot;GPU&quot; in device) and (&quot;GPU&quot; not in ie.available_devices):
        raise ValueError(
            f&quot;A GPU device is not available. Available devices are: {ie.available_devices}&quot;
        )
    else:
        benchmark_command = f&quot;benchmark_app -m {model_path} -d {device} -t {seconds} -api {api} -b {batch} -cdir {cache_dir}&quot;
        display(
            Markdown(
                f&quot;**Benchmark {model_path.name} with {device} for {seconds} seconds with {api} inference**&quot;
            )
        )
        display(Markdown(f&quot;Benchmark command: `{benchmark_command}`&quot;))

        benchmark_output = get_ipython().run_line_magic(&quot;sx&quot;, &quot;$benchmark_command&quot;)
        benchmark_result = [
            line
            for line in benchmark_output
            if not (line.startswith(r&quot;[&quot;) or line.startswith(&quot;      &quot;) or line == &quot;&quot;)
        ]
        print(&quot;\n&quot;.join(benchmark_result))
        print()
        if &quot;MULTI&quot; in device:
            devices = device.replace(&quot;MULTI:&quot;, &quot;&quot;).split(&quot;,&quot;)
            for single_device in devices:
                device_name = ie.get_metric(
                    device_name=single_device, metric_name=&quot;FULL_DEVICE_NAME&quot;
                )
                print(f&quot;{single_device} device: {device_name}&quot;)
        else:
            print(f&quot;Device: {ie.get_metric(device_name=device, metric_name=&#39;FULL_DEVICE_NAME&#39;)}&quot;)
</pre></div>
</div>
<section id="test-openvino-tools">
<h3>Test OpenVINO Tools<a class="headerlink" href="#test-openvino-tools" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>ie = IECore()
model_url = &quot;https://github.com/openvinotoolkit/openvino_notebooks/raw/main/notebooks/002-openvino-api/model/segmentation.xml&quot;
model_path = download_ir_model(model_url, &quot;model&quot;)
device = &quot;MULTI:CPU,GPU&quot; if &quot;GPU&quot; in ie.available_devices else &quot;CPU&quot;
display(Markdown(device))
benchmark_model(model_path=model_path, device=device, seconds=5)
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s1">&#39;model/segmentation.xml&#39;</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
<span class="s1">&#39;model/segmentation.bin&#39;</span> <span class="n">already</span> <span class="n">exists</span><span class="o">.</span>
</pre></div>
</div>
<p>CPU</p>
<p><strong>Benchmark segmentation.xml with CPU for 5 seconds with async
inference</strong></p>
<p>Benchmark command:
<code class="docutils literal notranslate"><span class="pre">benchmark_app</span> <span class="pre">-m</span> <span class="pre">/opt/home/k8sworker/cibuilds/ov-notebook/OVNotebookOps-231/.workspace/scm/ov-notebook/notebooks/utils/model/segmentation.xml</span> <span class="pre">-d</span> <span class="pre">CPU</span> <span class="pre">-t</span> <span class="pre">5</span> <span class="pre">-api</span> <span class="pre">async</span> <span class="pre">-b</span> <span class="pre">1</span> <span class="pre">-cdir</span> <span class="pre">model_cache</span></code></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Count</span><span class="p">:</span>          <span class="mi">240</span> <span class="n">iterations</span>
<span class="n">Duration</span><span class="p">:</span>       <span class="mf">5493.99</span> <span class="n">ms</span>
<span class="n">Latency</span><span class="p">:</span>
    <span class="n">Median</span><span class="p">:</span>     <span class="mf">267.73</span> <span class="n">ms</span>
    <span class="n">AVG</span><span class="p">:</span>        <span class="mf">270.53</span> <span class="n">ms</span>
    <span class="n">MIN</span><span class="p">:</span>        <span class="mf">252.38</span> <span class="n">ms</span>
    <span class="n">MAX</span><span class="p">:</span>        <span class="mf">321.37</span> <span class="n">ms</span>
<span class="n">Throughput</span><span class="p">:</span> <span class="mf">43.68</span> <span class="n">FPS</span>

<span class="n">Device</span><span class="p">:</span> <span class="n">Intel</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="n">Core</span><span class="p">(</span><span class="n">TM</span><span class="p">)</span> <span class="n">i9</span><span class="o">-</span><span class="mi">10920</span><span class="n">X</span> <span class="n">CPU</span> <span class="o">@</span> <span class="mf">3.50</span><span class="n">GHz</span>
</pre></div>
</div>
</section>
</section>
<section id="checks-and-alerts">
<h2>Checks and Alerts<a class="headerlink" href="#checks-and-alerts" title="Permalink to this headline">¶</a></h2>
<p>Create an alert class to show stylized info/error/warning messages and a
<code class="docutils literal notranslate"><span class="pre">check_device</span></code> function that checks whether a given device is
available.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>class NotebookAlert(Exception):
    def __init__(self, message: str, alert_class: str):
        &quot;&quot;&quot;
        Show an alert box with the given message.

        :param message: The message to display.
        :param alert_class: The class for styling the message. Options: info, warning, success, danger.
        &quot;&quot;&quot;
        self.message = message
        self.alert_class = alert_class
        self.show_message()

    def show_message(self):
        display(HTML(f&quot;&quot;&quot;&lt;div class=&quot;alert alert-{self.alert_class}&quot;&gt;{self.message}&quot;&quot;&quot;))


class DeviceNotFoundAlert(NotebookAlert):
    def __init__(self, device: str):
        &quot;&quot;&quot;
        Show a warning message about an unavailable device. This class does not check whether or
        not the device is available, use `check_device` to check this. The `check_device` function
        also shows the warning if the device is not found.

        :param device: The unavailable device.
        :return: A formatted alert box with the message that `device` is not available, and a list
                 of devices that are available.
        &quot;&quot;&quot;
        ie = IECore()
        supported_devices = ie.available_devices
        self.message = (
            f&quot;Running this cell requires a {device} device, &quot;
            &quot;which is not available on this system. &quot;
        )
        self.alert_class = &quot;warning&quot;
        if len(supported_devices) == 1:
            self.message += f&quot;The following device is available: {ie.available_devices[0]}&quot;
        else:
            self.message += (
                &quot;The following devices are available: &quot; f&quot;{&#39;, &#39;.join(ie.available_devices)}&quot;
            )
        super().__init__(self.message, self.alert_class)


def check_device(device: str) -&gt; bool:
    &quot;&quot;&quot;
    Check if the specified device is available on the system.

    :param device: Device to check. For example, CPU, GPU.
    :return: True if the device is available, False if not. If the device is not available,
             a `DeviceNotFoundAlert` message will be shown.
    &quot;&quot;&quot;
    ie = IECore()
    if device not in ie.available_devices:
        DeviceNotFoundAlert(device)
        return False
    else:
        return True


def check_openvino_version(version: str) -&gt; bool:
    &quot;&quot;&quot;
    Check if the specified OpenVINO version is installed.

    :param version: The OpenVINO version to check. Example: 2021.4.
    :return: True if the version is installed, False if not. If the version is not installed,
             an alert message will be shown.
    &quot;&quot;&quot;
    installed_version = openvino.inference_engine.get_version()
    if version not in installed_version:
        NotebookAlert(
            f&quot;This notebook requires OpenVINO {version}. &quot;
            f&quot;The version on your system is: &lt;i&gt;{installed_version}&lt;/i&gt;.&lt;br&gt;&quot;
            &quot;Run &lt;span style=&#39;font-family:monospace&#39;&gt;pip install --upgrade -r requirements.txt&lt;/span&gt; &quot;
            &quot;in the &#39;openvino_env&#39; environment to install this version. &quot;
            &quot;See the &lt;a href=&#39;https://github.com/openvinotoolkit/openvino_notebooks&#39;&gt;&quot;
            &quot;OpenVINO Notebooks README&lt;/a&gt; for detailed instructions&quot;,
            alert_class=&quot;danger&quot;,
        )
        return False
    else:
        return True
</pre></div>
</div>
<section id="test-alerts">
<h3>Test Alerts<a class="headerlink" href="#test-alerts" title="Permalink to this headline">¶</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>NotebookAlert(message=&quot;Hello, world!&quot;, alert_class=&quot;info&quot;)
DeviceNotFoundAlert(&quot;GPU&quot;);
</pre></div>
</div>
<div class="alert alert-info">Hello, world!<div class="alert alert-warning">Running this cell requires a GPU device, which is not available on this system. The following device is available: CPU<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>assert check_device(&quot;CPU&quot;)
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>if check_device(&quot;HELLOWORLD&quot;):
    print(&quot;Hello World device found.&quot;)
</pre></div>
</div>
<div class="alert alert-warning">Running this cell requires a HELLOWORLD device, which is not available on this system. The following device is available: CPU<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>check_openvino_version(&quot;2022.1&quot;);
</pre></div>
</div>
</section>
</section>
</section>


                </div>
            
            
                <div class='prev-next-bottom'>
                  
    <a class='button bttn-sec button-size-l' id="prev-link" href="405-paddle-ocr-webcam-with-output.html" title="previous page">Prev</a>
    <a class='button bttn-sec button-size-l' id="next-link" href="../api/api_reference.html" title="next page">Next</a>

                </div>
            
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2021, Intel®.<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.2.0.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>